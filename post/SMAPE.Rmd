---
title: "Symmetric MAPE is not symmetric"
author: "Pablo Cánovas Tourné"
date: "17 de julio de 2019"
output: html_document
---

### Refs

http://www.catchbull.com/catchblogs/why-mape-doesnt-work
https://en.wikipedia.org/wiki/Symmetric_mean_absolute_percentage_error
https://stats.stackexchange.com/questions/280464/is-mape-a-good-error-measurement-statistic-and-what-alternatives-are-there
https://robjhyndman.com/hyndsight/smape/

<!-- A better measure of relative prediction accuracty for model selection and model estimation ( Chris Tofallis, 2015): -->
https://poseidon01.ssrn.com/delivery.php?ID=912071094074109094069115029093025110000069085067010018086003069122074000022002100121034011107062116011014121092068067002120016015069090069028013066084099122096112019086019005105020067099126068064011082116019102096003091124077118086097090097087121114&EXT=pdf

### Introduction

I recently came across [this](https://robjhyndman.com/hyndsight/smape) super interesting discussion about sMAPE and I would like to
contribute with my own views.

MAPE is the acronym of Mean Absolute Percentage Error and is defined as

$$ MAPE = \frac{100}{N} \sum_{t=1}^{N} \frac{|A_t - F_t|}{|A_t|} $$

being $A_t$ the *Actuals* and $F_t$ the *Forecasts*

### The problem

There is some confusion and disagreement about the behaviour of MAPE.
MAPE express the deviation in relative terms and provides a simple interpretation of the error.
However, it suffer from some known issues:

* MAPE ranges from 0 to $\infty$: it diverges with $A_t\to0$ which leads to problems when dealing with data with zero values.
This problem is even worse when working with data with arbitrary zero values, e.g, forecasting temperatures near 0$^o$ in Celsius or Fahrenheit scale. To be fair, this would be an issue using any percentage error metric.

* MAPE **is said to be asymmetric** in the sense it puts heavier penalty on negative errors. When $F_t < A_t$ the maximum possible error value is 100%, however there is no limit when forecasting on the high side. Besides, given the same absolute difference $|A_t - F_t|$, MAPE is greater when $F_t > A_t$:

```{r, echo=FALSE, message=FALSE, warning=FALSE}
library(tidyverse)
library(knitr)
library(kableExtra)
```
```{r, echo=FALSE}
assymetricMape <- tibble(Case = c(1,2), Actual = c(100, 150), Forecast = c(150,100), AbsoluteDifference = 50, MAPE = c(50, 33))
kable_styling(kable_input = kable(assymetricMape), full_width = F)
```

There is some controversy over this last point.
Some people argue this is a false dichotomy because it doesn't make sense to compare two situations where you are exchanging forecast and actual values, and defend MAPE actually **is symmetric** because you can't get a lower MAPE just by lowering your forecasts:

```{r, echo=FALSE}
symmetricMape <- tibble(Case = c(1,2), Actual = c(100, 100), Forecast = c(150,50), AbsoluteDifference = 50, MAPE = c(50, 50))
kable_styling(kable_input = kable(symmetricMape), full_width = F)
```


### The...solution?

Trying to solve the alledgelly asymmetry, some alternative versions have been proposed. The more general one is:

$$ sMAPE = \frac{200}{N} \sum_{t=1}^{N}\frac{|y_t - \hat{y}_t|}{|y_t| + |\hat{y}_t|} $$

First thing to notice is that the range of this symmetric MAPE is (0,200] which is somewhat antiintuitive. I can't see myself explaining
algorithm deviations in such metric to anybody from a non-technical team. This could be solved simply dividing by 2, although that
would be an aesthetic change only.
On the bright side, this version of sMAPE doesn't diverge, which brings some sanity and stability to the metric.

But the aspect that really fascinates me is that the so-called **symmetric MAPE is not symmetric.** 
In fact, sMAPE symmetrizes the asymmetric case above, and the other way around: 

* Exchanging actual and forecast values produces the same sMAPE value. 

```{r, echo = FALSE}
mape_sMape1 <- tibble(Case = c(1,2), Actual = c(100, 150), Forecast = c(150,100), AbsoluteDifference = 50,
                      MAPE = c(50, 33),sMAPE = c(20, 20))
kable_styling(kable_input = kable(mape_sMape1), full_width = F)
```
* Modifying the forecast while holding fixed actual values and absolute deviation *do not* produce the same sMAPE value. This maybe the most important case. 

```{r, echo = FALSE}
mape_sMape2 <- tibble(Case = c(1,2), Actual = c(100, 100), Forecast = c(150,50), AbsoluteDifference = 50, 
                      MAPE = c(50, 50), sMAPE = c(20, 33))

kable_styling(kable_input = kable(mape_sMape2), 
              bootstrap_options = "basic", 
              # bootstrap_options = "striped", 
              full_width = F)
```

<!-- Another alternative is proposed to beat the inconveniences of MAPE: ln(Ft/At). -->
<!-- However, it presents the same problems of (a)symmetry than sMAPE: exchanging actual and forecasts leads to same error (with different sign though), whereas -->
<!-- "reversing the error" holding the actual value change the error value. -->


<!-- ---The most important case it is asymmetric now: Holding fixed the actual value and simply modifying the forecast never  -->
<!-- should change the error value. -->

The second point is a critical issue: simply biasing the model without improving its accuracy should never produce different error values.

<!-- mas blablabla aqui -->

Taking all this into account, the proposed metric seems to be worse than the original one. 

Quite surprising!

Relative error metrics have this kind of problems. You might want to take a look at some alternatives and a more general discussion in [this]() link.


<!-- From Wikipedia:  -->
<!-- Provided the data are strictly positive, a better measure of relative accuracy can be obtained based on the log of the accuracy ratio: log(Ft / At) This measure is easier to analyse statistically, and has valuable symmetry and unbiasedness properties. When used in constructing forecasting models the resulting prediction corresponds to the geometric mean (Tofallis, 2015).  -->



<!-- I hope this is useful info on the MAPE as a forecast accuracy metric. Since MAPE is so popular, it has many variations which I have captured in this post titled the family tree of MAPE. I am interested in your thoughts and comments. -->


