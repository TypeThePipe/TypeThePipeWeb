<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">
  <meta name="robots" content="index,follow">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Carlos Vecina">

  
  
  
    
  
  <meta name="description" content="Powerful type validation and discriminated Unions with Pydantic: Simplify data structures and ensure type safety. We are showcasing a few straightforward examples.">

  
  <link rel="alternate" hreflang="en-us" href="/post/pydantic-discriminated-union/">

  


  
  
  
  <meta name="theme-color" content="#0294A5">
  

  
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      
        
      

      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  





<script async src="https://www.googletagmanager.com/gtag/js?id=G-BHP7JGTF0S"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'G-BHP7JGTF0S', {});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu7deb2a6bfe7da9ae71f9387d98d158da_12352_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu7deb2a6bfe7da9ae71f9387d98d158da_12352_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="/post/pydantic-discriminated-union/">

  
  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="TypeThePipe">
  <meta property="og:url" content="/post/pydantic-discriminated-union/">
  <meta property="og:title" content="Pydantic discriminated unions. Some examples to simplify data structures and ensure type safety | TypeThePipe">
  <meta property="og:description" content="Powerful type validation and discriminated Unions with Pydantic: Simplify data structures and ensure type safety. We are showcasing a few straightforward examples."><meta property="og:image" content="/post/pydantic-discriminated-union/featured.png">
  <meta property="twitter:image" content="/post/pydantic-discriminated-union/featured.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2023-06-18T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2023-06-18T00:00:00&#43;00:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/pydantic-discriminated-union/"
  },
  "headline": "Pydantic discriminated unions. Some examples to simplify data structures and ensure type safety",
  
  "image": [
    "/post/pydantic-discriminated-union/featured.png"
  ],
  
  "datePublished": "2023-06-18T00:00:00Z",
  "dateModified": "2023-06-18T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Carlos Vecina"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "TypeThePipe",
    "logo": {
      "@type": "ImageObject",
      "url": "/images/logo_hu404f0ea59597fa66f625b1ea06c896ea_259550_192x192_fit_lanczos_2.png"
    }
  },
  "description": "Powerful type validation and discriminated Unions with Pydantic: Simplify data structures and ensure type safety. We are showcasing a few straightforward examples."
}
</script>

  

  


  


  







  <title>Pydantic discriminated unions. Some examples to simplify data structures and ensure type safety | TypeThePipe</title>
  <script async defer src="https://tools.luckyorange.com/core/lo.js?site-id=10579286"></script>
  
  
<script>var ezoicId = 473828; </script>
<script type="text/javascript" src="//go.ezoic.net/ezoic/ezoic.js"></script>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  






  


<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/"><img src="/images/logo_hu404f0ea59597fa66f625b1ea06c896ea_259550_0x70_resize_lanczos_2.png" alt="TypeThePipe"></a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/"><img src="/images/logo_hu404f0ea59597fa66f625b1ea06c896ea_259550_0x70_resize_lanczos_2.png" alt="TypeThePipe"></a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#vizstips"><span>Vizs & Tips</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#people"><span>About Us</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#mentorship"><span>Mentorship Program</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      

      

    </ul>

  </div>
</nav>


  


        <article class="article">
            





















  
  
    
  


<div class="article-container pt-3">
  <h1>Pydantic discriminated unions. Some examples to simplify data structures and ensure type safety</h1>

  
  <p class="page-subtitle">Powerful type validation and discriminated Unions with Pydantic: Simplify data structures and ensure type safety. We are showcasing a few straightforward examples.</p>
  

  


<div class="article-metadata">

  
  
  
  
  <div>
    

  
  <span><a href="/authors/carlos-vecina/">Carlos Vecina</a></span>
  </div>
  
  

  

  

  

  
  
  

  
  
  
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/categories/python/">Python</a>, <a href="/categories/post/">Post</a></span>
  

</div>

  














</div>





            <div class="article-container">
              <div class="article-style">
                
<script src="/post/pydantic-discriminated-union/index_files/header-attrs/header-attrs.js"></script>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {   }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } /* Alert */
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #7d9029; } /* Attribute */
code span.bn { color: #40a070; } /* BaseN */
code span.bu { color: #008000; } /* BuiltIn */
code span.cf { color: #007020; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4070a0; } /* Char */
code span.cn { color: #880000; } /* Constant */
code span.co { color: #60a0b0; font-style: italic; } /* Comment */
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #ba2121; font-style: italic; } /* Documentation */
code span.dt { color: #902000; } /* DataType */
code span.dv { color: #40a070; } /* DecVal */
code span.er { color: #ff0000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #40a070; } /* Float */
code span.fu { color: #06287e; } /* Function */
code span.im { color: #008000; font-weight: bold; } /* Import */
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #007020; font-weight: bold; } /* Keyword */
code span.op { color: #666666; } /* Operator */
code span.ot { color: #007020; } /* Other */
code span.pp { color: #bc7a00; } /* Preprocessor */
code span.sc { color: #4070a0; } /* SpecialChar */
code span.ss { color: #bb6688; } /* SpecialString */
code span.st { color: #4070a0; } /* String */
code span.va { color: #19177c; } /* Variable */
code span.vs { color: #4070a0; } /* VerbatimString */
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } /* Warning */
</style>


<p><img src="featured.png" width="400px" alt="Pydantic Python library logo." /></p>
<div id="what-is-an-union-discriminator-or-tagged-unions-and-its-role-in-pydantic" class="section level1">
<h1>What is an union discriminator or tagged unions, and its role in Pydantic?</h1>
<p>Well, well, well, look who decided to stroll into the world of Pydantic discriminators! 🕶️ Brace yourselves, folks, because we’re about to take a sarcastic and catchy rollercoaster ride through this wild jungle of coding wonders. Buckle up!</p>
<p>So, what’s all the buzz about Pydantic discriminators? Oh, they’re just the coolest thing since sliced bread, my friends! Picture this: you have a bunch of data models, each with their own quirks and peculiarities. It’s like dealing with a bunch of divas in a high school drama, except instead of gossip, it’s all about attributes and properties. Drama queens, am I right?</p>
<p>Now, let’s say you want to pick out the perfect model from this chaotic ensemble. How on earth are you going to do that? Fear not, because Pydantic discriminators are here to save the day, just like a superhero with an ironic sense of humor. They’re like the Sherlock Holmes of model selection, deducing the perfect fit for you.</p>
<p><br></p>
<div id="how-does-pydantic-discriminator-works" class="section level2">
<h2><strong>How does Pydantic discriminator works?</strong></h2>
<p>Pydantic’s discriminator feature allows the definition of data structures with multiple types, using a discriminator field to determine the actual object type. This enables type validation and serialization/deserialization based on the discriminator value, ensuring data integrity and flexibility in representing different types of objects.</p>
<p>Since <a href="https://docs.pydantic.dev/latest/usage/types/#discriminated-unions-aka-tagged-unions:~:text=Required%20Fields.-,Discriminated%20Unions%20(a.k.a.%20Tagged%20Unions,-)">Pydantic 1.9, we could make use of it</a>. Let’s showcase it in an easy way:</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="im">from</span> pydantic <span class="im">import</span> BaseModel, Field, parse_obj_as</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="im">from</span> typing <span class="im">import</span> Literal, Union, Annotated</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a></span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="kw">class</span> Tiger(BaseModel):</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a>    animal_type: Literal[<span class="st">&quot;tiger&quot;</span>] <span class="op">=</span> <span class="st">&quot;tiger&quot;</span></span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a>    ferocity_scale: <span class="bu">float</span> <span class="op">=</span> Field(..., ge<span class="op">=</span><span class="dv">0</span>, le<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a></span>
<span id="cb1-8"><a href="#cb1-8" tabindex="-1"></a><span class="kw">class</span> Shark(BaseModel):</span>
<span id="cb1-9"><a href="#cb1-9" tabindex="-1"></a>    animal_type: Literal[<span class="st">&quot;shark&quot;</span>] <span class="op">=</span> <span class="st">&quot;shark&quot;</span></span>
<span id="cb1-10"><a href="#cb1-10" tabindex="-1"></a>    ferocity_scale: <span class="bu">float</span> <span class="op">=</span> Field(..., ge<span class="op">=</span><span class="dv">0</span>, le<span class="op">=</span><span class="dv">10</span>)</span>
<span id="cb1-11"><a href="#cb1-11" tabindex="-1"></a></span>
<span id="cb1-12"><a href="#cb1-12" tabindex="-1"></a><span class="kw">class</span> Lion(BaseModel):</span>
<span id="cb1-13"><a href="#cb1-13" tabindex="-1"></a>    animal_type: Literal[<span class="st">&quot;lion&quot;</span>] <span class="op">=</span> <span class="st">&quot;lion&quot;</span></span>
<span id="cb1-14"><a href="#cb1-14" tabindex="-1"></a>    ferocity_scale: <span class="bu">float</span></span>
<span id="cb1-15"><a href="#cb1-15" tabindex="-1"></a></span>
<span id="cb1-16"><a href="#cb1-16" tabindex="-1"></a><span class="kw">class</span> WildAnimal(BaseModel):</span>
<span id="cb1-17"><a href="#cb1-17" tabindex="-1"></a>    __root__: Annotated[Union[Tiger, Shark, Lion], Field(..., discriminator<span class="op">=</span><span class="st">&#39;animal_type&#39;</span>)]</span>
<span id="cb1-18"><a href="#cb1-18" tabindex="-1"></a></span>
<span id="cb1-19"><a href="#cb1-19" tabindex="-1"></a>my_shark <span class="op">=</span> WildAnimal.parse_obj({<span class="st">&#39;animal_type&#39;</span>: <span class="st">&#39;shark&#39;</span>, <span class="st">&#39;ferocity_scale&#39;</span>: <span class="dv">5</span>}).__root__</span>
<span id="cb1-20"><a href="#cb1-20" tabindex="-1"></a><span class="co">#print(Shark(ferocity_scale=5).json())</span></span>
<span id="cb1-21"><a href="#cb1-21" tabindex="-1"></a></span>
<span id="cb1-22"><a href="#cb1-22" tabindex="-1"></a><span class="co"># Desarialice</span></span>
<span id="cb1-23"><a href="#cb1-23" tabindex="-1"></a>WildAnimal.parse_raw(Shark(ferocity_scale<span class="op">=</span><span class="dv">5</span>).json())</span></code></pre></div>
<pre><code>## WildAnimal(__root__=Shark(animal_type=&#39;shark&#39;, ferocity_scale=5.0))</code></pre>
<div class="sourceCode" id="cb3"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">isinstance</span>(my_shark, Shark))</span></code></pre></div>
<pre><code>## True</code></pre>
<p>The below polimorfic code example and some other interesting discussions could be found here:
<a href="https://github.com/pydantic/pydantic/discussions/5785" class="uri">https://github.com/pydantic/pydantic/discussions/5785</a></p>
<p><br></p>
</div>
<div id="pydantic-annotated-union-discriminator-example" class="section level2">
<h2><strong>Pydantic Annotated union discriminator example</strong></h2>
<p>But we could use a very simple approach to achieve most of the usage by using the <code>Annotated</code> union.</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>Animal <span class="op">=</span> Annotated[Union[Tiger, Shark], Field(discriminator<span class="op">=</span><span class="st">&#39;animal_type&#39;</span>)]</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a>raw_data <span class="op">=</span> {</span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>    <span class="st">&quot;animal_type&quot;</span>: <span class="st">&quot;tiger&quot;</span>,</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a>    <span class="st">&quot;ferocity_scale&quot;</span>: <span class="dv">6</span></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>}</span>
<span id="cb5-6"><a href="#cb5-6" tabindex="-1"></a>parse_obj_as(Animal, raw_data)</span></code></pre></div>
<pre><code>## Tiger(animal_type=&#39;tiger&#39;, ferocity_scale=6.0)</code></pre>
<p>Get ready for the magic of the Field class, courtesy of Pydantic. It’s armed with a special power called “discriminator.” By setting the discriminator to “pet_type,” we unlock the ability to distinguish between our fantastic creatures. It’s like giving them their own special spotlight!</p>
<p>Hold on tight, because we’re about to venture into the wild lands of raw_data. It holds the secrets of a “pet_type” with the fiery spirit of a “tiger” and a mesmerizing “stripes” count of 6. It’s as if we’re peering into a digital zoo!</p>
<p>And now, it’s showtime! We summon the powerful parse_obj_as to work its coding wizardry. We present it with our regal Animal and the enigmatic raw_data. Abracadabra! With a wave of its wand, the transformation unfolds. The raw data morphs into a stunning representation of our chosen Animal. It’s like a magical metamorphosis!</p>
<p><br></p>
</div>
<div id="example-of-polimorfic-base-model" class="section level2">
<h2><strong>Example of Polimorfic Base Model</strong></h2>
<div class="sourceCode" id="cb7"><pre class="sourceCode python"><code class="sourceCode python"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="kw">class</span> PolymorphicBaseModel(BaseModel):</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>    <span class="bu">type</span>: <span class="bu">str</span></span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a></span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a>    _subtypes <span class="op">=</span> <span class="bu">dict</span>()</span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a>    <span class="kw">def</span> <span class="fu">__init_subclass__</span>(subcls, <span class="bu">type</span><span class="op">=</span><span class="va">None</span>, <span class="op">**</span>kwargs):</span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a>        <span class="bu">super</span>().<span class="fu">__init_subclass__</span>(<span class="op">**</span>kwargs)</span>
<span id="cb7-8"><a href="#cb7-8" tabindex="-1"></a>        <span class="cf">if</span> <span class="bu">type</span>:</span>
<span id="cb7-9"><a href="#cb7-9" tabindex="-1"></a>            <span class="co"># n.b. if a subclass declares its own _subtypes dict, it&#39;ll take precedence over this one.</span></span>
<span id="cb7-10"><a href="#cb7-10" tabindex="-1"></a>            <span class="co"># This would allow us to re-use the same type names across different classes.</span></span>
<span id="cb7-11"><a href="#cb7-11" tabindex="-1"></a>            <span class="cf">if</span> <span class="bu">type</span> <span class="kw">in</span> subcls._subtypes:</span>
<span id="cb7-12"><a href="#cb7-12" tabindex="-1"></a>                <span class="cf">raise</span> <span class="pp">AttributeError</span>(</span>
<span id="cb7-13"><a href="#cb7-13" tabindex="-1"></a>                    <span class="ss">f&quot;Class </span><span class="sc">{</span>subcls<span class="sc">}</span><span class="ss"> cannot be registered with polymorphic type=&#39;</span><span class="sc">{</span><span class="bu">type</span><span class="sc">}</span><span class="ss">&#39; because it&#39;s already registered &quot;</span></span>
<span id="cb7-14"><a href="#cb7-14" tabindex="-1"></a>                    <span class="ss">f&quot; to </span><span class="sc">{</span>subcls<span class="sc">.</span>_subtypes[<span class="bu">type</span>]<span class="sc">}</span><span class="ss">&quot;</span></span>
<span id="cb7-15"><a href="#cb7-15" tabindex="-1"></a>                )</span>
<span id="cb7-16"><a href="#cb7-16" tabindex="-1"></a>            subcls._subtypes[<span class="bu">type</span>] <span class="op">=</span> subcls</span>
<span id="cb7-17"><a href="#cb7-17" tabindex="-1"></a>    <span class="at">@classmethod</span></span>
<span id="cb7-18"><a href="#cb7-18" tabindex="-1"></a>    <span class="kw">def</span> _convert_to_real_type(cls, data):</span>
<span id="cb7-19"><a href="#cb7-19" tabindex="-1"></a>        data_type <span class="op">=</span> data.get(<span class="st">&quot;type&quot;</span>)</span>
<span id="cb7-20"><a href="#cb7-20" tabindex="-1"></a></span>
<span id="cb7-21"><a href="#cb7-21" tabindex="-1"></a>        <span class="cf">if</span> data_type <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb7-22"><a href="#cb7-22" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">ValueError</span>(<span class="ss">f&quot;Missing &#39;type&#39; for </span><span class="sc">{</span>cls<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-23"><a href="#cb7-23" tabindex="-1"></a></span>
<span id="cb7-24"><a href="#cb7-24" tabindex="-1"></a>        subcls <span class="op">=</span> cls._subtypes.get(data_type)</span>
<span id="cb7-25"><a href="#cb7-25" tabindex="-1"></a></span>
<span id="cb7-26"><a href="#cb7-26" tabindex="-1"></a>        <span class="cf">if</span> subcls <span class="kw">is</span> <span class="va">None</span>:</span>
<span id="cb7-27"><a href="#cb7-27" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="ss">f&quot;Unsupported sub-type: </span><span class="sc">{</span>data_type<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-28"><a href="#cb7-28" tabindex="-1"></a>        <span class="cf">if</span> <span class="kw">not</span> <span class="bu">issubclass</span>(subcls, cls):</span>
<span id="cb7-29"><a href="#cb7-29" tabindex="-1"></a>            <span class="cf">raise</span> <span class="pp">TypeError</span>(<span class="ss">f&quot;Inferred class </span><span class="sc">{</span>subcls<span class="sc">}</span><span class="ss"> is not a subclass of </span><span class="sc">{</span>cls<span class="sc">}</span><span class="ss">&quot;</span>)</span>
<span id="cb7-30"><a href="#cb7-30" tabindex="-1"></a></span>
<span id="cb7-31"><a href="#cb7-31" tabindex="-1"></a>        <span class="cf">return</span> subcls(<span class="op">**</span>data)</span>
<span id="cb7-32"><a href="#cb7-32" tabindex="-1"></a></span>
<span id="cb7-33"><a href="#cb7-33" tabindex="-1"></a>    <span class="at">@classmethod</span></span>
<span id="cb7-34"><a href="#cb7-34" tabindex="-1"></a>    <span class="kw">def</span> parse_obj(cls, data):</span>
<span id="cb7-35"><a href="#cb7-35" tabindex="-1"></a>        <span class="cf">return</span> cls._convert_to_real_type(data)</span>
<span id="cb7-36"><a href="#cb7-36" tabindex="-1"></a>    </span>
<span id="cb7-37"><a href="#cb7-37" tabindex="-1"></a>    </span>
<span id="cb7-38"><a href="#cb7-38" tabindex="-1"></a><span class="kw">class</span> Animal(PolymorphicBaseModel):</span>
<span id="cb7-39"><a href="#cb7-39" tabindex="-1"></a>    name: <span class="bu">str</span></span>
<span id="cb7-40"><a href="#cb7-40" tabindex="-1"></a>    color: <span class="bu">str</span> <span class="op">=</span> <span class="va">None</span></span>
<span id="cb7-41"><a href="#cb7-41" tabindex="-1"></a></span>
<span id="cb7-42"><a href="#cb7-42" tabindex="-1"></a><span class="kw">class</span> Cat(Animal, <span class="bu">type</span><span class="op">=</span><span class="st">&quot;cat&quot;</span>):</span>
<span id="cb7-43"><a href="#cb7-43" tabindex="-1"></a>    <span class="bu">type</span>: Literal[<span class="st">&quot;cat&quot;</span>] <span class="op">=</span> <span class="st">&quot;cat&quot;</span></span>
<span id="cb7-44"><a href="#cb7-44" tabindex="-1"></a>    hairless: <span class="bu">bool</span></span>
<span id="cb7-45"><a href="#cb7-45" tabindex="-1"></a></span>
<span id="cb7-46"><a href="#cb7-46" tabindex="-1"></a><span class="kw">class</span> Dog(Animal, <span class="bu">type</span><span class="op">=</span><span class="st">&quot;dog&quot;</span>):</span>
<span id="cb7-47"><a href="#cb7-47" tabindex="-1"></a>    <span class="bu">type</span>: Literal[<span class="st">&quot;dog&quot;</span>] <span class="op">=</span> <span class="st">&quot;dog&quot;</span></span>
<span id="cb7-48"><a href="#cb7-48" tabindex="-1"></a>    breed: <span class="bu">str</span></span>
<span id="cb7-49"><a href="#cb7-49" tabindex="-1"></a></span>
<span id="cb7-50"><a href="#cb7-50" tabindex="-1"></a>cat_instance <span class="op">=</span> Animal.parse_obj({<span class="st">&quot;type&quot;</span>:<span class="st">&quot;cat&quot;</span>, <span class="st">&quot;hairless&quot;</span>: <span class="va">False</span>, <span class="st">&quot;name&quot;</span>: <span class="st">&quot;meaw&quot;</span>, <span class="st">&quot;color&quot;</span>: <span class="st">&quot;black&quot;</span>})</span>
<span id="cb7-51"><a href="#cb7-51" tabindex="-1"></a><span class="bu">print</span>(<span class="bu">isinstance</span>(cat_instance, Cat))</span></code></pre></div>
<pre><code>## True</code></pre>
<p>Tthe PolymorphicBaseModel, a base class that sets the stage for polymorphic behavior. It defines a required type attribute and introduces a hidden _subtypes dictionary to keep track of subtypes.</p>
<p>Next, we dive into the <strong>init_subclass</strong> method, where the magic happens. It allows subclasses to register themselves with a specific polymorphic type. This lets us distinguish between different subtypes within the PolymorphicBaseModel hierarchy.</p>
<p>But hold on, there’s more to uncover! We make use of the _convert_to_real_type method, responsible for converting data to its actual subtype based on the provided type attribute. It checks if the type is valid, finds the corresponding subclass, and ensures it is a valid subclass of the base class.</p>
<p>Finally, we arrive at the parse_obj method, where the true parsing takes place. It serves as the entry point for parsing objects of the polymorphic hierarchy. Using the _convert_to_real_type method, it transforms the data into an instance of the appropriate subclass.</p>
<p>And there you have it! A glimpse into the realm of polymorphic models. It’s a world where base classes and subtypes come together, allowing for flexible and dynamic object parsing. Embrace the power of polymorphism and let your code adapt and evolve with grace!</p>
<p><br></p>
</div>
<div id="pydantic-2-typeadapter-to-parse-data-into-a-discriminated-union" class="section level2">
<h2><strong>Pydantic 2: TypeAdapter to parse data into a discriminated union</strong></h2>
<p>In Pydantic v2, you can utilize the TypeAdapter to parse data into a discriminated union. However, please note that Pydantic v2 is currently in pre-release, and the module’s current version is v1.7.</p>
<p>Therefore, <strong>make sure to upgrade to Pydantic v2 when it becomes available to utilize this feature.</strong></p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>from pydantic import TypeAdapter</span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a></span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>adapter <span class="ot">=</span> <span class="fu">TypeAdapter</span>(Annotated[Union[Child1, Child2], <span class="fu">Field</span>(<span class="at">discriminator=</span><span class="st">&#39;type&#39;</span>)])</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a></span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a>child <span class="ot">=</span> <span class="fu">adapter.validate_json</span>(my_json_data)</span></code></pre></div>
<p><br></p>
</div>
<div id="stay-updated-on-pydantic-and-python-tips" class="section level2">
<h2><strong>Stay updated on Pydantic and Python tips</strong></h2>
<p>Hopefully, this post has helped familiarize you with the usage of unions and discriminators in Pydantic, showcasing some of its functionalities and enabling you to enjoy their benefits.</p>
<p>If you want to stay updated…</p>
<!-- Begin Mailchimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="https://csshake.surge.sh/csshake.min.css">
<style type="text/css">
	#mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
	 #mc_embed_signup .button {
  background-color: #0294A5; /* Green */
  color: white;
  transition-duration: 0.4s;
}
#mc_embed_signup .button:hover {
  background-color: #379392 !important; 
}

</style>
<div id="mc_embed_signup">
<form action="https://typethepipe.us4.list-manage.com/subscribe/post?u=91551f7ed29389a0de4f47665&amp;id=d95c503a48" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
 <div id="mc_embed_signup_scroll">
	<label for="mce-EMAIL"> Suscribe for more Python and Pydantic tips!</label>
	<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="your best email" required>
    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_91551f7ed29389a0de4f47665_d95c503a48" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Submit!" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>

<!--End mc_embed_signup-->
<style>
p {
  word-spacing: 3px;
  text-indent: 20px;
  text-align: justify;
}
.page-subtitle {
  text-align: left  !important;
    text-indent: 0px !important;
}
.card-text {
  text-align: left  !important;
    text-indent: 0px !important;
}
</style>
<style>
.hljs-keyword,.hljs-selector-tag,.hljs-subst{color:#2e8516;font-weight:bold}.hljs-comment, .hljs-quote {
    color: #0e847b;
    font-style: italic;
}.hljs-number, .hljs-literal, .hljs-variable, .hljs-template-variable, .hljs-tag .hljs-attr {
    color: #008021;
}
</style>
</div>
</div>

              </div>
              





<div class="article-tags">
  
  <a class="badge badge-light" href="/tags/python/">Python</a>
  
  <a class="badge badge-light" href="/tags/pydantic/">Pydantic</a>
  
</div>



<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/pydantic-discriminated-union/&amp;text=Pydantic%20discriminated%20unions.%20Some%20examples%20to%20simplify%20data%20structures%20and%20ensure%20type%20safety" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/pydantic-discriminated-union/&amp;t=Pydantic%20discriminated%20unions.%20Some%20examples%20to%20simplify%20data%20structures%20and%20ensure%20type%20safety" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Pydantic%20discriminated%20unions.%20Some%20examples%20to%20simplify%20data%20structures%20and%20ensure%20type%20safety&amp;body=/post/pydantic-discriminated-union/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/pydantic-discriminated-union/&amp;title=Pydantic%20discriminated%20unions.%20Some%20examples%20to%20simplify%20data%20structures%20and%20ensure%20type%20safety" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=Pydantic%20discriminated%20unions.%20Some%20examples%20to%20simplify%20data%20structures%20and%20ensure%20type%20safety%20/post/pydantic-discriminated-union/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/post/pydantic-discriminated-union/&amp;title=Pydantic%20discriminated%20unions.%20Some%20examples%20to%20simplify%20data%20structures%20and%20ensure%20type%20safety" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  
    
    





  
  
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="avatar mr-3 avatar-circle" src="/authors/carlos-vecina/carlos-vecina-avatar_hudcecee8c8ed4dd07fd2b73e656fad71c_149347_270x270_fill_lanczos_center_2.png" alt="Carlos Vecina">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/authors/carlos-vecina/">Carlos Vecina</a></h5>
      <h6 class="card-subtitle">Senior Data Scientist at Jobandtalent</h6>
      <p class="card-text">Senior Data Scientist at Jobandtalent  |  AI &amp; Data Science for Business</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/deepchals" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/carlos-vecina/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/CarlosVecina" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://autarponics.com" target="_blank" rel="noopener">
        <i class="fa fa-home"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>


  










  
  
  <div class="article-widget content-widget-hr">
    <h3>Related</h3>
    <ul>
      
      <li><a href="/post/pydantic-enum-intenum/">Pydantic, Enums and IntEnums. A Story of Validation</a></li>
      
      <li><a href="/vizs-and-tips/ursina-vector-rotation/">Ursina vector rotation. The right and easy way to deal with this 3d Python module!</a></li>
      
      <li><a href="/vizs-and-tips/mock-celery-task-pytest/">Mock Celery task in Pytest</a></li>
      
    </ul>
  </div>
  


            </div>
        </article>
  

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/python.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.37431be2d92d7fb0160054761ab79602.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>

    
    

    






  
  
  <div class="container">
    <footer class="site-footer">
  
  <p class="powered-by">
    
      <a href="/privacy/">Privacy Policy</a>
    
    
       &middot; 
      <a href="/terms/">Terms and Conditions</a>
    
  </p>
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.
	<a href="https://www.r-bloggers.com/">
	<img border="0" alt="R Bloggers icon" src="/img/r_bloggers.png" width="100" height="100">
	</a>
	<br>
	<a href="https://www.python-bloggers.com/">
	<img border="0" alt="Python Bloggers icon" src="/img/python_logo.png" width="100" height="100">
	</a>
    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
  <style>
    #consent-notice {padding: 1rem 1rem; display: none; text-align: center; position: fixed; bottom: 0; width: calc(100% - 2rem); background: #222; color: rgba(255,255,255,0.8);}
    #consent-notice span {margin-right: 1rem;}
    #consent-notice button {cursor: pointer; display: inline-block; width: auto;}
    #consent-notice span a {color: inherit; text-decoration: underline; text-decoration-color: rgba(255,255,255,0.5);}
    #consent-notice button.btn {margin-left: 0.5rem;}
    #consent-notice button.btn.manage-consent {background: rgba(255,255,255,0.1); font-weight: normal;}
    
    #consent-overlay {position: fixed; left: 0; top: 0; width: 100%; height: 100vh; display: none; background: rgba(0,0,0,0.75); z-index: 999999; overflow: auto; cursor: pointer;}
    #consent-overlay.active {display: flex;}
    #consent-overlay > div {background: white; width: 100%; max-width: 30rem; padding: 1.75rem; margin: auto; cursor: initial;}
    #consent-overlay > div > div {display: flex; align-items: flex-start; margin-bottom: 1rem;}
    #consent-overlay > div > div:last-child {margin: 0;}
    #consent-overlay h3 {padding-top: 0;}
    #consent-overlay input {margin-top: 0.3rem;}
    #consent-overlay label {display: block;}
    #consent-overlay .btn {margin-right: 0.5rem;}
    #consent-overlay button.btn.save-consent {background: rgba(0,0,0,0.6); font-weight: normal;}

    @media (max-width: 767px) {
        #consent-overlay > div {padding: 1.75rem 1rem;}
        #consent-notice span {display: block; padding-top: 3px; margin-bottom: 1.5rem;}
        #consent-notice button.btn {position: relative; bottom: 4px;}
    }
</style>
<div id="consent-notice"><span>We would like to use <a class="manage-consent" href="#manage-consent">third party code</a> to improve the functionality of this website.</span><button class="btn manage-consent">Manage preferences</button><button class="btn deny-consent">Deny</button><button class="btn approve-consent">Allow</button></div>
<div id="consent-overlay">
    <div>
        
            <div>
                <input type="checkbox" id="item0" value="1" name="item0" checked disabled />
                <label for="item0">
                    <h3>Google Anaytics (functional)</h3>
                    <p>This code gives us insight into the number of anonymized people that visit our website, where they are from and what they are clicking on in order to create better content.</p>
                </label>
            </div>
        
            <div>
                <input type="checkbox" id="item1" value="1" name="item1"  />
                <label for="item1">
                    <h3>Marketing</h3>
                    <p>Marketing pourposes cookies.</p>
                </label>
            </div>
        
        <div>
            <button id="save-consent" class="btn save-consent" data-consentvalue="0">Save preferences</button>
            <button class="btn approve-consent">Allow all</button>
        </div>
    </div>
</div>
<script>

    const scripts = [];
    scripts[ 0 ] = "/js/mkt.js";

    function createCookie(name,value,days) {
        var expires = "";
        if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (days*24*60*60*1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + value + expires + "; path=/";
    }
    function readCookie(name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(';');
        for(var i=0;i < ca.length;i++) {
            var c = ca[i];
            while (c.charAt(0)==' ') c = c.substring(1,c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
        }
        return null;
    }
    function eraseCookie(name) {
        createCookie(name,"",-1);
    }
    function denyAllConsentScripts() {
        var consentValue = "";
        scripts.forEach(function(){
            consentValue = consentValue + "0";
        });
        acceptSomeConsentScripts(consentValue);
    }
    function acceptAllConsentScripts() {
        var consentValue = "";
        scripts.forEach(function(){
            consentValue = consentValue + "1";
        });
        acceptSomeConsentScripts(consentValue);
    }
    function acceptSomeConsentScripts(consentValue) {
        setConsentInputs(consentValue);
        createCookie('consent-settings',consentValue,31);
        document.getElementById('consent-notice').style.display = 'none';
        document.getElementById('consent-overlay').classList.remove('active');
        loadConsentScripts(consentValue);
    }
    function loadConsentScripts(consentValue) {
        scripts.forEach(function(value,key){
            
            if(consentValue[key]=="1") {
                var s = document.createElement('script');
                s.type = 'text/javascript';
                s.src = value;
                document.body.appendChild(s);
            }
        });
    }
    function setConsentInputs(consentValue) {
        var elements = document.querySelectorAll('#consent-overlay input:not([disabled])');
        elements.forEach(function(el,index) {
            if(consentValue[index]=="1") el.checked = true;
            else el.checked = false;
        });
    }
    function setConsentValue() {
        var elements = document.querySelectorAll('#consent-overlay input:not([disabled])');
        var consentValue = "";
        elements.forEach(function(el) {
            if(el.checked) consentValue = consentValue + "1";
            else consentValue = consentValue + "0";
        });
        document.getElementById("save-consent").dataset.consentvalue = consentValue;
    }

    var elements = document.querySelectorAll('#consent-overlay input:not([disabled])');
    elements.forEach(function(el) {
        el.checked = false;
    });

    if(readCookie('consent-settings')) {
        var consentValue = readCookie('consent-settings').toString();
        
        setConsentInputs(consentValue);
        loadConsentScripts(consentValue);
    } else {
        document.getElementById('consent-notice').style.display = 'block';
    }
    var elements = document.querySelectorAll('.manage-consent');
    elements.forEach(function(el) {
        el.addEventListener("click",function() {
            document.getElementById('consent-overlay').classList.toggle('active');
        });
    });
    var elements = document.querySelectorAll('.deny-consent');
    elements.forEach(function(el) {
        el.addEventListener("click",function() {
            denyAllConsentScripts();
        });
    });
    var elements = document.querySelectorAll('.approve-consent');
    elements.forEach(function(el) {
        el.addEventListener("click",function() {
            acceptAllConsentScripts();
        });
    });
    document.getElementById("save-consent").addEventListener("click",function() {
        setConsentValue();
        acceptSomeConsentScripts(this.dataset.consentvalue);
    });
    document.getElementById("consent-overlay").addEventListener("click",function(e) {
        if (!document.querySelector("#consent-overlay > div").contains(e.target)){
            this.classList.toggle('active');
        }
    });
</script>


    
        <script type="text/javascript" src="/js/ga.js"></script>
    

    

</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
