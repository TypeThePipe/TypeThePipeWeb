<!DOCTYPE html>
<html lang="en-us">

<head>

  <meta charset="utf-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <meta http-equiv="X-UA-Compatible" content="IE=edge">
  <meta name="generator" content="Source Themes Academic 4.8.0">
  <meta name="robots" content="index,follow">

  

  
  
  
  
  
    
    
    
  
  

  <meta name="author" content="Carlos Vecina">

  
  
  
    
  
  <meta name="description" content="Starting the &#39;Value Invetsing with R&#39; series. Brush up your Ggplot skills: Using the Financial Market Prep API data to create stunning plots with a Financial Times inspired ggplot theme.">

  
  <link rel="alternate" hreflang="en-us" href="/post/value-invest-market-cap-data-r-ggplot-financial-times-theme/">

  


  
  
  
  <meta name="theme-color" content="#0294A5">
  

  
  

  
  
  
  
    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/academicons/1.8.6/css/academicons.min.css" integrity="sha256-uFVgMKfistnJAfoCUQigIl+JfUaP47GrRKjf6CTPVmw=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.0-1/css/all.min.css" integrity="sha256-4w9DunooKSr3MFXHXWyFER38WmPdm361bQS/2KUWZbU=" crossorigin="anonymous">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.css" integrity="sha256-Vzbj7sDDS/woiFS3uNKo8eIuni59rjyNGtXfstRzStA=" crossorigin="anonymous">

    
    
    
      
    
    
      
      
        
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/github.min.css" crossorigin="anonymous" title="hl-light">
          <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/styles/dracula.min.css" crossorigin="anonymous" title="hl-dark" disabled>
        
      
    

    
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.css" integrity="sha256-SHMGCYmST46SoyGgo4YR/9AlK1vf3ff84Aq9yK4hdqM=" crossorigin="anonymous">
    

    

    
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
    
      

      
      

      
        <script src="https://cdnjs.cloudflare.com/ajax/libs/lazysizes/5.1.2/lazysizes.min.js" integrity="sha256-Md1qLToewPeKjfAHU1zyPwOutccPAm5tahnaw7Osw0A=" crossorigin="anonymous" async></script>
      
    
      

      
      

      
    
      

      
      

      
    
      

      
      
        
      

      
    
      

      
      

      
    

  

  
  
  
  <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Montserrat:400,700%7CRoboto:400,400italic,700%7CRoboto+Mono&display=swap">
  

  
  
  
  
  <link rel="stylesheet" href="/css/academic.css">

  





<script async src="https://www.googletagmanager.com/gtag/js?id=UA-155621946-1"></script>
<script>
  window.dataLayer = window.dataLayer || [];

  function gtag() {
      dataLayer.push(arguments);
  }

  function trackOutboundLink(url, target) {
    gtag('event', 'click', {
         'event_category': 'outbound',
         'event_label': url,
         'transport_type': 'beacon',
         'event_callback': function () {
           if (target !== '_blank') {
             document.location = url;
           }
         }
    });
    console.debug("Outbound link clicked: " + url);
  }

  function onClickCallback(event) {
    if ((event.target.tagName !== 'A') || (event.target.host === window.location.host)) {
      return;
    }
    trackOutboundLink(event.target, event.target.getAttribute('target'));  
  }

  gtag('js', new Date());
  gtag('config', 'UA-155621946-1', {});

  
  document.addEventListener('click', onClickCallback, false);
</script>


  


  

  <link rel="manifest" href="/index.webmanifest">
  <link rel="icon" type="image/png" href="/images/icon_hu7deb2a6bfe7da9ae71f9387d98d158da_12352_32x32_fill_lanczos_center_2.png">
  <link rel="apple-touch-icon" type="image/png" href="/images/icon_hu7deb2a6bfe7da9ae71f9387d98d158da_12352_192x192_fill_lanczos_center_2.png">

  <link rel="canonical" href="/post/value-invest-market-cap-data-r-ggplot-financial-times-theme/">

  
  
  
  
  
    
  
  
  <meta property="twitter:card" content="summary_large_image">
  
  <meta property="og:site_name" content="TypeThePipe">
  <meta property="og:url" content="/post/value-invest-market-cap-data-r-ggplot-financial-times-theme/">
  <meta property="og:title" content="Financial Markets &amp; Value Invest in R (I) - Analyzing Market Cap data with fmpcloudr and ggplot | TypeThePipe">
  <meta property="og:description" content="Starting the &#39;Value Invetsing with R&#39; series. Brush up your Ggplot skills: Using the Financial Market Prep API data to create stunning plots with a Financial Times inspired ggplot theme."><meta property="og:image" content="/post/value-invest-market-cap-data-r-ggplot-financial-times-theme/featured.png">
  <meta property="twitter:image" content="/post/value-invest-market-cap-data-r-ggplot-financial-times-theme/featured.png"><meta property="og:locale" content="en-us">
  
    
      <meta property="article:published_time" content="2023-03-10T00:00:00&#43;00:00">
    
    <meta property="article:modified_time" content="2023-03-10T00:00:00&#43;00:00">
  

  


    






  




<script type="application/ld+json">
{
  "@context": "https://schema.org",
  "@type": "BlogPosting",
  "mainEntityOfPage": {
    "@type": "WebPage",
    "@id": "/post/value-invest-market-cap-data-r-ggplot-financial-times-theme/"
  },
  "headline": "Financial Markets \u0026 Value Invest in R (I) - Analyzing Market Cap data with fmpcloudr and ggplot",
  
  "image": [
    "/post/value-invest-market-cap-data-r-ggplot-financial-times-theme/featured.png"
  ],
  
  "datePublished": "2023-03-10T00:00:00Z",
  "dateModified": "2023-03-10T00:00:00Z",
  
  "author": {
    "@type": "Person",
    "name": "Carlos Vecina"
  },
  
  "publisher": {
    "@type": "Organization",
    "name": "TypeThePipe",
    "logo": {
      "@type": "ImageObject",
      "url": "/images/logo_hu404f0ea59597fa66f625b1ea06c896ea_259550_192x192_fit_lanczos_2.png"
    }
  },
  "description": "Starting the 'Value Invetsing with R' series. Brush up your Ggplot skills: Using the Financial Market Prep API data to create stunning plots with a Financial Times inspired ggplot theme."
}
</script>

  

  


  


  







  <title>Financial Markets &amp; Value Invest in R (I) - Analyzing Market Cap data with fmpcloudr and ggplot | TypeThePipe</title>
  <script async defer src="https://tools.luckyorange.com/core/lo.js?site-id=10579286"></script>
  
  
<script>var ezoicId = 473828; </script>
<script type="text/javascript" src="//go.ezoic.net/ezoic/ezoic.js"></script>

</head>

<body id="top" data-spy="scroll" data-offset="70" data-target="#TableOfContents" >

  <aside class="search-results" id="search">
  <div class="container">
    <section class="search-header">

      <div class="row no-gutters justify-content-between mb-3">
        <div class="col-6">
          <h1>Search</h1>
        </div>
        <div class="col-6 col-search-close">
          <a class="js-search" href="#"><i class="fas fa-times-circle text-muted" aria-hidden="true"></i></a>
        </div>
      </div>

      <div id="search-box">
        
        <input name="q" id="search-query" placeholder="Search..." autocapitalize="off"
        autocomplete="off" autocorrect="off" spellcheck="false" type="search">
        
      </div>

    </section>
    <section class="section-search-results">

      <div id="search-hits">
        
      </div>

    </section>
  </div>
</aside>


  






  


<nav class="navbar navbar-expand-lg navbar-light compensate-for-scrollbar" id="navbar-main">
  <div class="container">

    
    <div class="d-none d-lg-inline-flex">
      <a class="navbar-brand" href="/"><img src="/images/logo_hu404f0ea59597fa66f625b1ea06c896ea_259550_0x70_resize_lanczos_2.png" alt="TypeThePipe"></a>
    </div>
    

    
    <button type="button" class="navbar-toggler" data-toggle="collapse"
            data-target="#navbar-content" aria-controls="navbar" aria-expanded="false" aria-label="Toggle navigation">
    <span><i class="fas fa-bars"></i></span>
    </button>
    

    
    <div class="navbar-brand-mobile-wrapper d-inline-flex d-lg-none">
      <a class="navbar-brand" href="/"><img src="/images/logo_hu404f0ea59597fa66f625b1ea06c896ea_259550_0x70_resize_lanczos_2.png" alt="TypeThePipe"></a>
    </div>
    

    
    
    <div class="navbar-collapse main-menu-item collapse justify-content-start" id="navbar-content">

      
      <ul class="navbar-nav d-md-inline-flex">
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#posts"><span>Posts</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#vizstips"><span>Vizs & Tips</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#people"><span>About Us</span></a>
        </li>

        
        

        

        
        
        
          
        

        
        
        
        
        
        
          
          
          
            
          
          
        

        <li class="nav-item">
          <a class="nav-link " href="/#mentorship"><span>Mentorship Program</span></a>
        </li>

        
        

      

        
      </ul>
    </div>

    <ul class="nav-icons navbar-nav flex-row ml-auto d-flex pl-md-2">
      
      <li class="nav-item">
        <a class="nav-link js-search" href="#"><i class="fas fa-search" aria-hidden="true"></i></a>
      </li>
      

      

      

    </ul>

  </div>
</nav>


  


        <article class="article">
            





















  
  
    
  


<div class="article-container pt-3">
  <h1>Financial Markets &amp; Value Invest in R (I) - Analyzing Market Cap data with fmpcloudr and ggplot</h1>

  
  <p class="page-subtitle">Starting the &lsquo;Value Invetsing with R&rsquo; series. Brush up your Ggplot skills: Using the Financial Market Prep API data to create stunning plots with a Financial Times inspired ggplot theme</p>
  

  


<div class="article-metadata">

  
  
  
  
  <div>
    

  
  <span><a href="/authors/carlos-vecina/">Carlos Vecina</a></span>
  </div>
  
  

  

  

  

  
  
  

  
  
  
  <span class="article-categories">
    <i class="fas fa-folder mr-1"></i><a href="/categories/r/">R</a>, <a href="/categories/tips/">Tips</a></span>
  

</div>

  














</div>





            <div class="article-container">
              <div class="article-style">
                
<script src="/post/value-invest-market-cap-data-r-ggplot-financial-times-theme/index_files/header-attrs/header-attrs.js"></script>
<style type="text/css">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
  { counter-reset: source-line 0; }
pre.numberSource code > span
  { position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
  { content: counter(source-line);
    position: relative; left: -1em; text-align: right; vertical-align: baseline;
    border: none; display: inline-block;
    -webkit-touch-callout: none; -webkit-user-select: none;
    -khtml-user-select: none; -moz-user-select: none;
    -ms-user-select: none; user-select: none;
    padding: 0 4px; width: 4em;
    color: #aaaaaa;
  }
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa;  padding-left: 4px; }
div.sourceCode
  {  background-color: #f8f8f8; }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ef2929; } /* Alert */
code span.an { color: #8f5902; font-weight: bold; font-style: italic; } /* Annotation */
code span.at { color: #204a87; } /* Attribute */
code span.bn { color: #0000cf; } /* BaseN */
code span.cf { color: #204a87; font-weight: bold; } /* ControlFlow */
code span.ch { color: #4e9a06; } /* Char */
code span.cn { color: #8f5902; } /* Constant */
code span.co { color: #8f5902; font-style: italic; } /* Comment */
code span.cv { color: #8f5902; font-weight: bold; font-style: italic; } /* CommentVar */
code span.do { color: #8f5902; font-weight: bold; font-style: italic; } /* Documentation */
code span.dt { color: #204a87; } /* DataType */
code span.dv { color: #0000cf; } /* DecVal */
code span.er { color: #a40000; font-weight: bold; } /* Error */
code span.ex { } /* Extension */
code span.fl { color: #0000cf; } /* Float */
code span.fu { color: #204a87; font-weight: bold; } /* Function */
code span.im { } /* Import */
code span.in { color: #8f5902; font-weight: bold; font-style: italic; } /* Information */
code span.kw { color: #204a87; font-weight: bold; } /* Keyword */
code span.op { color: #ce5c00; font-weight: bold; } /* Operator */
code span.ot { color: #8f5902; } /* Other */
code span.pp { color: #8f5902; font-style: italic; } /* Preprocessor */
code span.sc { color: #ce5c00; font-weight: bold; } /* SpecialChar */
code span.ss { color: #4e9a06; } /* SpecialString */
code span.st { color: #4e9a06; } /* String */
code span.va { color: #000000; } /* Variable */
code span.vs { color: #4e9a06; } /* VerbatimString */
code span.wa { color: #8f5902; font-weight: bold; font-style: italic; } /* Warning */
</style>


<p><img src="featured.png" height="500px" width="600px" alt="Financial Times Theme in Ggplot2 R 4.0" /></p>
<p><br></p>
<p>Over the past months, heavy market drifts have occurred, and no one could have imagined the frenzy of free money being stopped. <strong>The idea that the end of history had arrived has been shattered</strong>.</p>
<p>As we entered <strong>2023, we witnessed certain stocks soaring in the markets</strong>, attempting to recover from their previous losses, while other <strong>macroeconomic indicators continued to deteriorate.</strong> However, uncertainty still weighs heavily on the minds of investors, perhaps even more so than ever before, given the threats of inflation, labor market instability, dollarization pitfalls, trust decay in central banks and financial institutions, interest rates, potential real estate crash in specific local areas…</p>
<p>A significant question raises: <strong>how to protect ourselves against such circumstances</strong> and what can we expect in each possible scenario?</p>
<p>Therefore, it presents a fantastic opportunity to <strong>brush up our R, tidy &amp; ggplot, skills and delve further into the market structure</strong>. Through this series of posts, we are primarily examining the stock market, its dynamics, cycles, valuation metrics, as well as the pre-IPO and startup ecosystem, the bond market, real estate, and even a touch of crypto. However, as you’ll see, we are mainly deepening our understanding of value/fundamentals-focused investing strategies.</p>
<p><br></p>
<div id="what-is-value-investing" class="section level1">
<h1>What is value investing?</h1>
<p>Value investing is an investment strategy that involves buying stocks or other financial assets that are believed to be undervalued by the market, <strong>focusing in their intrinsic value</strong>. The ultimate goal of value investing then, is to identify <strong>companies that are temporarily undervalued by the market due to factors such as short-term negative news, volatility, or even investor sentiment</strong>. By buying these assets at a discounted price, value investors hope to profit from the market’s eventual recognition of the company’s true value, resulting in a higher stock price.</p>
<p>So we are far in this series from the high frequency, short-term or daily trades. Although, it’s a quite prolific and profitable field, also an interesting intersection between Data Science and Finance ;)</p>
<p>The approach, skills and even the involved risks are quite different from one way to trade to other. The <em>value investing approach</em> could also be seen or performed as a defensive strategy, not as greedy as other ones. But it also involves long-term and macroeconomic risks that are not present (or have less impact) in short-to-medium term strategies.</p>
<p><br></p>
</div>
<div id="generating-financial-market-prep-free-api-key" class="section level1">
<h1>Generating Financial Market Prep free API key</h1>
<p>To start, we need to access the data. There are many options for doing so, one of which is to create an API token in the Financial Market Prep page.</p>
<p>The available data on this API continues to grow month after month. Truth be told, some functionalities could be improved, such as allowing for more parameterization in data retrieval. Nevertheless, <strong>the sheer amount and quality of the data available is just stunning</strong>, which is why we are using it throughout this series.</p>
<p><a href="https://site.financialmodelingprep.com/login">Select the free plan.</a> Then we’ll come back and set up the API key in your R environment.</p>
<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(tidyverse)</span>
<span id="cb1-2"><a href="#cb1-2" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb1-3"><a href="#cb1-3" tabindex="-1"></a><span class="fu">library</span>(ggthemes)</span>
<span id="cb1-4"><a href="#cb1-4" tabindex="-1"></a><span class="fu">library</span>(magrittr)</span>
<span id="cb1-5"><a href="#cb1-5" tabindex="-1"></a><span class="fu">library</span>(lubridate)</span>
<span id="cb1-6"><a href="#cb1-6" tabindex="-1"></a><span class="fu">library</span>(factoextra)</span>
<span id="cb1-7"><a href="#cb1-7" tabindex="-1"></a><span class="fu">library</span>(fmpcloudr)</span></code></pre></div>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a><span class="fu">fmpc_set_token</span>(<span class="st">&#39;your_token&#39;</span>) <span class="co"># example fmpc_set_token(&#39;09431214923a63117b0p00ff1cart2alp&#39;) </span></span></code></pre></div>
<p>Now the token is already set up, so we can start downloading data. As in March 2023, you can do 250 call to the free API.</p>
<p>In this post we are exploring the API and doing the first plots</p>
<p><br></p>
</div>
<div id="financial-market-prep-api-in-fmpcloudr-package" class="section level1">
<h1>Financial Market Prep API in fmpcloudr package</h1>
<p>As you have seen, they also have a very handy R package, <code>fmpcloudr</code>. In this paragraph we are briefly exploring the kind of data available.</p>
<ul>
<li>Daily market capitalization, OHLC (open, high, low, close) prices, and volume data.</li>
</ul>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>fmpcloudr<span class="sc">::</span><span class="fu">fmpc_price_current</span>()</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a>fmpcloudr<span class="sc">::</span><span class="fu">fmpc_price_intraday</span>()</span></code></pre></div>
<ul>
<li>Historical price data with up to 1-minute resolution and historical dividents</li>
</ul>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a>fmpcloudr<span class="sc">::</span><span class="fu">fmpc_price_history</span>()</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a></span>
<span id="cb4-3"><a href="#cb4-3" tabindex="-1"></a>fmpcloudr<span class="sc">::</span><span class="fu">fmpc_security_dividends</span>(symbols, <span class="at">startDate =</span> <span class="st">&#39;2020-01-01&#39;</span>)</span></code></pre></div>
<ul>
<li>Financial ratios and stock fundamentals, including liquidity, profitability, debt, operating performance, cash flow, investment valuation ratios, and other key metrics, updated quarterly and annually.</li>
</ul>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a>fmpcloudr<span class="sc">::</span><span class="fu">fmpc_financial_metrics</span>()</span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a></span>
<span id="cb5-3"><a href="#cb5-3" tabindex="-1"></a>fmpcloudr<span class="sc">::</span><span class="fu">fmpc_financial_metrics</span>()</span>
<span id="cb5-4"><a href="#cb5-4" tabindex="-1"></a></span>
<span id="cb5-5"><a href="#cb5-5" tabindex="-1"></a>fmpcloudr<span class="sc">::</span><span class="fu">fmpc_earning_call_transcript</span>()</span></code></pre></div>
<ul>
<li>Analysts’ price targets to provide insight into market expectations.</li>
</ul>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a>fmpcloudr<span class="sc">::</span><span class="fu">fmpc_analyst_outlook</span>()</span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a>fmpcloudr<span class="sc">::</span><span class="fu">fmpc_economic_results</span>()</span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a>fmpcloudr<span class="sc">::</span><span class="fu">fmpc_security_ratings</span>()</span></code></pre></div>
<ul>
<li>Sentiment analysis to gauge overall market sentiment towards a stock.</li>
</ul>
<p>Sentiment data not available in the R package. So we have to construct the GET call. We are showing how in next posts and opening a PR to their package.</p>
<ul>
<li>Technical indicators</li>
</ul>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a><span class="co"># Simple moving average</span></span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>fmpcloudr<span class="sc">::</span><span class="fu">fmpc_security_tech_indic</span>(symbols, <span class="at">indicator =</span> <span class="st">&#39;SMA&#39;</span>, <span class="at">freq =</span> <span class="st">&#39;daily&#39;</span>, <span class="at">period =</span> <span class="dv">10</span>)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a> </span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co"># Exponential moving average</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a>fmpcloudr<span class="sc">::</span><span class="fu">fmpc_security_tech_indic</span>(symbols, <span class="at">indicator =</span> <span class="st">&#39;EMA&#39;</span>,  <span class="at">freq =</span> <span class="st">&#39;1min&#39;</span>, <span class="at">period =</span> <span class="dv">10</span>)</span></code></pre></div>
<ul>
<li>Insiders trade and institutional ownership data to keep you informed about significant stockholders.</li>
</ul>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>fmpcloudr<span class="sc">::</span><span class="fu">fmpc_13f_data</span>() <span class="co"># holders</span></span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a></span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a>fmpcloudr<span class="sc">::</span><span class="fu">fmpc_cots_data</span>()</span></code></pre></div>
<ul>
<li>Real-time stock price data, SEC filings, institutional holders, price target, and other essential information.</li>
</ul>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a>fmpcloudr<span class="sc">::</span><span class="fu">fmpc_rss_sec</span>()</span></code></pre></div>
<ul>
<li>Macroeconomic data and Calendar events tracking upcoming dividends, stock splits.. ant its historical data.</li>
</ul>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>fmpcloudr<span class="sc">::</span><span class="fu">fmpc_economic_results</span>()</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a></span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>fmpcloudr<span class="sc">::</span><span class="fu">fmpc_economic_results</span>(<span class="at">event =</span> <span class="st">&#39;adpEmploymentChange&#39;</span>, <span class="at">country =</span> <span class="st">&#39;US&#39;</span>) </span>
<span id="cb10-4"><a href="#cb10-4" tabindex="-1"></a></span>
<span id="cb10-5"><a href="#cb10-5" tabindex="-1"></a>fmpcloudr<span class="sc">::</span><span class="fu">fmpc_calendar_events</span>(<span class="st">&#39;earning&#39;</span>)</span></code></pre></div>
<ul>
<li>Information on funds, European markets, forex, crypto, and commodities.</li>
</ul>
<p>Such and awesome collection of data! :D And it’s probably enough (with the free tier) to start to analyze and even slow trade in a more <em>value investing</em> way.</p>
<p>More information in their <a href="https://site.financialmodelingprep.com/developer/docs">documentation</a></p>
<p><br></p>
<div id="market-capitalization-in-r" class="section level2">
<h2>Market Capitalization in R</h2>
<p>As promised, we are just introducing the package and brushing up our ggplot skills. Therefore, we are focusing in this post on the evolution of market cap, allowing us to compare trends between different stocks. <strong>It is well known that growth stocks have experienced a massive surge in recent years, ranging from technology growth companies to pump-and-dump penny stocks, ‘meme-stocks’ defying the establishment (good luck Credit Suisse, SVB..) and SPACs frenzy.</strong> The market has been flooded with free money for almost a decade, with tech players lowering the entry barriers for retail investors, and benefiting from lockdown savings and subsidies.</p>
<p>Let’s examine the impact of this phenomenon on a set of stocks categorized as ‘growth’ and ‘value’. Since life is a continuum, we will first categorize them by hand according to the consensus. We will then conduct an initial analysis, which will be elaborated further in subsequent posts, attempting to cluster them based on their actual performance. In this chapter, we will use the market cap fluctuation to achieve this, although other features could also be utilized and macroeconomic factors taken into account. Stay tuned for upcoming TypeThePipe posts!</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a>symbols <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;AAPL&#39;</span>, <span class="st">&#39;META&#39;</span>, <span class="st">&#39;AMZN&#39;</span>, <span class="st">&#39;GOOG&#39;</span>,<span class="st">&#39;MSFT&#39;</span>)</span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>data <span class="ot">&lt;-</span> fmpcloudr<span class="sc">::</span><span class="fu">fmpc_security_mrktcap</span>(symbols, <span class="at">limit =</span> <span class="dv">30</span><span class="sc">*</span><span class="dv">12</span><span class="sc">*</span><span class="dv">12</span>)</span></code></pre></div>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a>data <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">ymd</span>(date))</span></code></pre></div>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a><span class="fu">ggplot</span>(data, <span class="fu">aes</span>(date, marketCap, <span class="at">colour =</span> symbol)) <span class="sc">+</span></span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a>  <span class="fu">geom_line</span>() </span></code></pre></div>
<p><img src="/post/value-invest-market-cap-data-r-ggplot-financial-times-theme/index_files/figure-html/unnamed-chunk-16-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="financial-times-theme-in-ggplot" class="section level2">
<h2>Financial Times Theme in Ggplot</h2>
<p>Not bad for a 2 lines plot, but lets add some Financial Times theme kind of flavor:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># old chunk in my codebase seen in Reddit but and can&#39;t find the source. If anyone has the original link, very glad to add it here! :)</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>ft_theme <span class="ot">&lt;-</span> </span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a>  <span class="fu">theme</span>(<span class="at">panel.grid.major.x =</span><span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&quot;wheat4&quot;</span>),</span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a>        <span class="at">panel.grid.major.y =</span><span class="fu">element_line</span>(<span class="at">colour =</span> <span class="st">&quot;wheat4&quot;</span>),</span>
<span id="cb14-5"><a href="#cb14-5" tabindex="-1"></a>        <span class="at">panel.grid.minor.x =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-6"><a href="#cb14-6" tabindex="-1"></a>        <span class="at">panel.grid.minor.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-7"><a href="#cb14-7" tabindex="-1"></a>        <span class="at">axis.text =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb14-8"><a href="#cb14-8" tabindex="-1"></a>        <span class="at">axis.title.x =</span> <span class="fu">element_text</span>(<span class="at">colour =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">8</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>, <span class="at">vjust =</span> <span class="fl">0.8</span>),</span>
<span id="cb14-9"><a href="#cb14-9" tabindex="-1"></a>        <span class="at">axis.title.y =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-10"><a href="#cb14-10" tabindex="-1"></a>        <span class="at">strip.text =</span> <span class="fu">element_text</span>(<span class="at">size=</span><span class="dv">8</span>, <span class="at">colour =</span> <span class="st">&quot;blue4&quot;</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb14-11"><a href="#cb14-11" tabindex="-1"></a>        <span class="at">plot.title =</span> ggtext<span class="sc">::</span><span class="fu">element_markdown</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">14</span>, <span class="at">face =</span> <span class="st">&quot;bold&quot;</span>),</span>
<span id="cb14-12"><a href="#cb14-12" tabindex="-1"></a>        <span class="at">plot.subtitle =</span> ggtext<span class="sc">::</span><span class="fu">element_markdown</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">size =</span> <span class="dv">8</span>),</span>
<span id="cb14-13"><a href="#cb14-13" tabindex="-1"></a>        <span class="at">plot.tag =</span> <span class="fu">element_text</span>(<span class="at">color =</span> <span class="st">&quot;black&quot;</span>, <span class="at">face =</span> <span class="st">&quot;italic&quot;</span>, <span class="at">size =</span> <span class="dv">182</span>, <span class="at">lineheight =</span> <span class="fl">0.9</span>),</span>
<span id="cb14-14"><a href="#cb14-14" tabindex="-1"></a>        <span class="at">plot.tag.position =</span> <span class="fu">c</span>(<span class="fl">0.15</span>,<span class="fl">0.02</span>),</span>
<span id="cb14-15"><a href="#cb14-15" tabindex="-1"></a>        <span class="at">plot.caption =</span> ggtext<span class="sc">::</span><span class="fu">element_markdown</span>(),</span>
<span id="cb14-16"><a href="#cb14-16" tabindex="-1"></a>        <span class="at">panel.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;seashell2&quot;</span>),</span>
<span id="cb14-17"><a href="#cb14-17" tabindex="-1"></a>        <span class="at">plot.background =</span> <span class="fu">element_rect</span>(<span class="at">fill =</span> <span class="st">&quot;seashell2&quot;</span>), </span>
<span id="cb14-18"><a href="#cb14-18" tabindex="-1"></a>        <span class="at">panel.border =</span> <span class="fu">element_blank</span>(),</span>
<span id="cb14-19"><a href="#cb14-19" tabindex="-1"></a>        <span class="at">panel.spacing.y =</span> <span class="fu">unit</span>(<span class="dv">3</span>, <span class="st">&quot;lines&quot;</span>)</span>
<span id="cb14-20"><a href="#cb14-20" tabindex="-1"></a>        ) </span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a>data <span class="sc">%&gt;%</span> </span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(date, marketCap, <span class="at">group=</span>symbol, <span class="at">colour=</span>symbol)) <span class="sc">+</span></span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour=</span><span class="st">&quot;none&quot;</span>) <span class="sc">+</span> </span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="at">data =</span> data <span class="sc">%&gt;%</span> <span class="fu">filter</span>(date<span class="sc">==</span><span class="fu">max</span>(date)),</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">label =</span> symbol),</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a>              <span class="at">label.size =</span> <span class="fl">0.1</span>,  <span class="at">size=</span><span class="fl">2.2</span>,</span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a>              <span class="at">label.padding =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb15-9"><a href="#cb15-9" tabindex="-1"></a>              <span class="at">nudge_x=</span><span class="dv">200</span>) <span class="sc">+</span></span>
<span id="cb15-10"><a href="#cb15-10" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">clip =</span> <span class="st">&#39;off&#39;</span>) <span class="sc">+</span>        <span class="co"># Allow labels to bleed past the canvas boundaries</span></span>
<span id="cb15-11"><a href="#cb15-11" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">&quot;6 month&quot;</span>,  <span class="co"># Date labels for each month.</span></span>
<span id="cb15-12"><a href="#cb15-12" tabindex="-1"></a>               <span class="at">date_labels =</span> <span class="st">&quot;%b%y&quot;</span>,</span>
<span id="cb15-13"><a href="#cb15-13" tabindex="-1"></a>               <span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">90</span>)) <span class="sc">+</span></span>
<span id="cb15-14"><a href="#cb15-14" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels=</span><span class="cf">function</span>(x)  <span class="fu">sprintf</span>(<span class="st">&quot;%d Billion&quot;</span>, x <span class="sc">/</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">9</span>)) <span class="sc">+</span> </span>
<span id="cb15-15"><a href="#cb15-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Market Cap evolution - FAAMG&quot;</span>,</span>
<span id="cb15-16"><a href="#cb15-16" tabindex="-1"></a>       <span class="at">subtitle=</span><span class="st">&quot;&lt;span style=&#39;color: #A9A9A9;&#39;&gt;&lt;b&gt;Apple&lt;/b&gt;&lt;/span&gt;,</span></span>
<span id="cb15-17"><a href="#cb15-17" tabindex="-1"></a><span class="st">       &lt;span style=&#39;color: #E7B800;&#39;&gt;&lt;b&gt;Amazon&lt;/b&gt;&lt;/span&gt;, </span></span>
<span id="cb15-18"><a href="#cb15-18" tabindex="-1"></a><span class="st">       &lt;span style=&#39;color: #FC4E07;&#39;&gt;&lt;b&gt;Microsoft&lt;/b&gt;&lt;/span&gt; and </span></span>
<span id="cb15-19"><a href="#cb15-19" tabindex="-1"></a><span class="st">       &lt;span style=&#39;color: #0D7680;&#39;&gt;&lt;b&gt;Meta&lt;/b&gt;&lt;/span&gt;&quot;</span>,</span>
<span id="cb15-20"><a href="#cb15-20" tabindex="-1"></a>       <span class="at">x=</span><span class="st">&quot; &quot;</span>)<span class="sc">+</span> </span>
<span id="cb15-21"><a href="#cb15-21" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#A9A9A9&quot;</span>, <span class="st">&quot;#E7B800&quot;</span>, <span class="st">&quot;#34AB53&quot;</span>, <span class="st">&quot;#0D7680&quot;</span>, <span class="st">&quot;#FC4E07&quot;</span>)) <span class="sc">+</span></span>
<span id="cb15-22"><a href="#cb15-22" tabindex="-1"></a>  ft_theme</span></code></pre></div>
<p><img src="/post/value-invest-market-cap-data-r-ggplot-financial-times-theme/index_files/figure-html/unnamed-chunk-18-1.png" width="672" /></p>
<p>Let’s do the same reusing our Financial Times inspired theme to some considered <em>value stocks</em>.</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a>symbols_value <span class="ot">=</span> <span class="fu">c</span>(<span class="st">&#39;MCD&#39;</span>, <span class="st">&#39;BRK-A&#39;</span>, <span class="st">&#39;PG&#39;</span>, <span class="st">&#39;KO&#39;</span>)</span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>data_value <span class="ot">&lt;-</span> fmpcloudr<span class="sc">::</span><span class="fu">fmpc_security_mrktcap</span>(symbols_value, <span class="at">limit =</span> <span class="dv">30</span><span class="sc">*</span><span class="dv">12</span><span class="sc">*</span><span class="dv">12</span>)</span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a>data_value <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">date =</span> <span class="fu">ymd</span>(date),</span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>                       <span class="at">symbol =</span> <span class="fu">str_replace</span>(symbol, <span class="st">&quot;BRK-A&quot;</span>, <span class="st">&quot;BRK&quot;</span>))</span></code></pre></div>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>data_value <span class="sc">%&gt;%</span> </span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(date, marketCap, <span class="at">group=</span>symbol, <span class="at">colour=</span>symbol)) <span class="sc">+</span></span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a>  <span class="fu">geom_line</span>(<span class="at">size =</span> <span class="fl">0.5</span>) <span class="sc">+</span> </span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour=</span><span class="st">&quot;none&quot;</span>) <span class="sc">+</span> </span>
<span id="cb18-5"><a href="#cb18-5" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="at">data =</span> data_value <span class="sc">%&gt;%</span> <span class="fu">filter</span>(date<span class="sc">==</span><span class="fu">max</span>(date)),</span>
<span id="cb18-6"><a href="#cb18-6" tabindex="-1"></a>              <span class="fu">aes</span>(<span class="at">label =</span> symbol),</span>
<span id="cb18-7"><a href="#cb18-7" tabindex="-1"></a>              <span class="at">label.size =</span> <span class="fl">0.1</span>,  <span class="at">size=</span><span class="dv">3</span>,</span>
<span id="cb18-8"><a href="#cb18-8" tabindex="-1"></a>              <span class="at">label.padding =</span> <span class="fu">unit</span>(<span class="fl">0.2</span>, <span class="st">&quot;lines&quot;</span>),</span>
<span id="cb18-9"><a href="#cb18-9" tabindex="-1"></a>              <span class="at">nudge_x=</span><span class="dv">200</span>) <span class="sc">+</span></span>
<span id="cb18-10"><a href="#cb18-10" tabindex="-1"></a>  <span class="fu">coord_cartesian</span>(<span class="at">clip =</span> <span class="st">&#39;off&#39;</span>) <span class="sc">+</span>        <span class="co"># Allow labels to bleed past the canvas boundaries</span></span>
<span id="cb18-11"><a href="#cb18-11" tabindex="-1"></a>  <span class="fu">scale_x_date</span>(<span class="at">date_breaks =</span> <span class="st">&quot;6 month&quot;</span>,  <span class="co"># Date labels for each month.</span></span>
<span id="cb18-12"><a href="#cb18-12" tabindex="-1"></a>               <span class="at">date_labels =</span> <span class="st">&quot;%b%y&quot;</span>,</span>
<span id="cb18-13"><a href="#cb18-13" tabindex="-1"></a>               <span class="at">guide =</span> <span class="fu">guide_axis</span>(<span class="at">angle =</span> <span class="dv">90</span>)) <span class="sc">+</span></span>
<span id="cb18-14"><a href="#cb18-14" tabindex="-1"></a>  <span class="fu">scale_y_continuous</span>(<span class="at">labels=</span><span class="cf">function</span>(x)  <span class="fu">sprintf</span>(<span class="st">&quot;%d Billion&quot;</span>, x <span class="sc">/</span> <span class="dv">10</span><span class="sc">^</span><span class="dv">9</span>)) <span class="sc">+</span> </span>
<span id="cb18-15"><a href="#cb18-15" tabindex="-1"></a>  <span class="fu">labs</span>(<span class="at">title=</span><span class="st">&quot;Market Cap evolution - Value Stocks&quot;</span>,</span>
<span id="cb18-16"><a href="#cb18-16" tabindex="-1"></a>       <span class="at">subtitle=</span><span class="st">&quot;&lt;span style=&#39;color: #554178;&#39;&gt;&lt;b&gt;Berkshire Hathaway&lt;/b&gt;&lt;/span&gt;,</span></span>
<span id="cb18-17"><a href="#cb18-17" tabindex="-1"></a><span class="st">       &lt;span style=&#39;color: #003CAE;&#39;&gt;&lt;b&gt;Procter &amp; Gamble&lt;/b&gt;&lt;/span&gt;, </span></span>
<span id="cb18-18"><a href="#cb18-18" tabindex="-1"></a><span class="st">       &lt;span style=&#39;color: #df2b24;&#39;&gt;&lt;b&gt;Coca-Cola&lt;/b&gt;&lt;/span&gt; and </span></span>
<span id="cb18-19"><a href="#cb18-19" tabindex="-1"></a><span class="st">       &lt;span style=&#39;color: #E7B800;&#39;&gt;&lt;b&gt;Mcdonald&#39;s&lt;/b&gt;&lt;/span&gt;&quot;</span>,</span>
<span id="cb18-20"><a href="#cb18-20" tabindex="-1"></a>       <span class="at">x=</span><span class="st">&quot; &quot;</span>)<span class="sc">+</span> </span>
<span id="cb18-21"><a href="#cb18-21" tabindex="-1"></a>  <span class="fu">scale_color_manual</span>(<span class="at">values =</span> <span class="fu">c</span>(<span class="st">&quot;#554178&quot;</span>, <span class="st">&quot;#df2b24&quot;</span>, <span class="st">&quot;#E7B800&quot;</span>, <span class="st">&quot;#003CAE&quot;</span>)) <span class="sc">+</span></span>
<span id="cb18-22"><a href="#cb18-22" tabindex="-1"></a>  ft_theme</span></code></pre></div>
<p><img src="/post/value-invest-market-cap-data-r-ggplot-financial-times-theme/index_files/figure-html/unnamed-chunk-22-1.png" width="672" /></p>
<p><br></p>
</div>
<div id="could-we-cluster-stocks-based-in-their-recent-2023-performance" class="section level2">
<h2>Could we cluster stocks based in their recent 2023 performance?</h2>
<p>Time series clustering is a very controversial topic. Therefore we are skipping it during this first introductory post, and we are using a simple clustering based on simple stats: daily return (approximated using the already downloaded market cap delta) and volatility.</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>data_basic_stats <span class="ot">&lt;-</span> data <span class="sc">%&gt;%</span> </span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>  <span class="fu">filter</span>(date<span class="sc">&gt;=</span><span class="st">&#39;2023-01-01&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>  <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span> </span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lag_mktcap =</span> <span class="fu">lag</span>(marketCap,<span class="at">order_by =</span> date),</span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a>         <span class="at">diff =</span> (marketCap <span class="sc">-</span> lag_mktcap) <span class="sc">/</span>lag_mktcap <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a>  <span class="fu">summarise_at</span>(<span class="at">.vars =</span> <span class="st">&#39;diff&#39;</span>, <span class="fu">c</span>(<span class="fu">funs</span>(<span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>)), <span class="fu">funs</span>(<span class="fu">sd</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>))))</span></code></pre></div>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>data_value_basic_stats <span class="ot">&lt;-</span> data_value <span class="sc">%&gt;%</span> </span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a>  <span class="fu">filter</span>(date<span class="sc">&gt;=</span><span class="st">&#39;2023-01-01&#39;</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a>  <span class="fu">group_by</span>(symbol) <span class="sc">%&gt;%</span> </span>
<span id="cb20-4"><a href="#cb20-4" tabindex="-1"></a>  <span class="fu">mutate</span>(<span class="at">lag_mktcap =</span> <span class="fu">lag</span>(marketCap,<span class="at">order_by =</span> date),</span>
<span id="cb20-5"><a href="#cb20-5" tabindex="-1"></a>         <span class="at">diff =</span> (marketCap <span class="sc">-</span> lag_mktcap) <span class="sc">/</span>lag_mktcap <span class="sc">*</span> <span class="dv">100</span>) <span class="sc">%&gt;%</span> </span>
<span id="cb20-6"><a href="#cb20-6" tabindex="-1"></a>  <span class="fu">summarise_at</span>(<span class="at">.vars =</span> <span class="st">&#39;diff&#39;</span>, <span class="fu">c</span>(<span class="fu">funs</span>(<span class="fu">mean</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>)), <span class="fu">funs</span>(<span class="fu">sd</span>(., <span class="at">na.rm =</span> <span class="cn">TRUE</span>))))</span></code></pre></div>
<p>Since we are only examining the dataset and it only has two dimensions, we opt to use the straightforward elbow method to select 3 clusters. However, we could also try with 2 and 4 clusters to compare the outcomes.</p>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>data_stats <span class="ot">&lt;-</span> data_basic_stats <span class="sc">%&gt;%</span> <span class="fu">bind_rows</span>(data_value_basic_stats)</span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a>tot_withinss <span class="ot">&lt;-</span> <span class="fu">map_dbl</span>(<span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>, <span class="cf">function</span>(k) {</span>
<span id="cb21-4"><a href="#cb21-4" tabindex="-1"></a>  model <span class="ot">&lt;-</span> <span class="fu">kmeans</span>(data_stats <span class="sc">%&gt;%</span> <span class="fu">select</span>(mean, sd), <span class="at">centers =</span> k)</span>
<span id="cb21-5"><a href="#cb21-5" tabindex="-1"></a>  model<span class="sc">$</span>tot.withinss</span>
<span id="cb21-6"><a href="#cb21-6" tabindex="-1"></a>})</span>
<span id="cb21-7"><a href="#cb21-7" tabindex="-1"></a></span>
<span id="cb21-8"><a href="#cb21-8" tabindex="-1"></a><span class="fu">data.frame</span>(<span class="at">k =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>,</span>
<span id="cb21-9"><a href="#cb21-9" tabindex="-1"></a>           <span class="at">tot_withinss =</span> tot_withinss) <span class="sc">%&gt;%</span></span>
<span id="cb21-10"><a href="#cb21-10" tabindex="-1"></a>  <span class="fu">ggplot</span>(<span class="fu">aes</span>(<span class="at">x =</span> k, <span class="at">y =</span> tot_withinss)) <span class="sc">+</span></span>
<span id="cb21-11"><a href="#cb21-11" tabindex="-1"></a>  <span class="fu">geom_line</span>() <span class="sc">+</span></span>
<span id="cb21-12"><a href="#cb21-12" tabindex="-1"></a>  <span class="fu">scale_x_continuous</span>(<span class="at">breaks =</span> <span class="dv">2</span><span class="sc">:</span><span class="dv">5</span>)</span></code></pre></div>
<p><img src="/post/value-invest-market-cap-data-r-ggplot-financial-times-theme/index_files/figure-html/elbow-1.png" width="672" /></p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a>fit <span class="ot">=</span> <span class="fu">kmeans</span>(data_stats <span class="sc">%&gt;%</span> <span class="fu">select</span>(mean, sd), <span class="dv">3</span>)</span>
<span id="cb22-2"><a href="#cb22-2" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" tabindex="-1"></a>data_stats <span class="sc">%&lt;&gt;%</span> <span class="fu">mutate</span>(<span class="at">cluster =</span> fit<span class="sc">$</span>cluster,</span>
<span id="cb22-4"><a href="#cb22-4" tabindex="-1"></a>                      <span class="at">cluster_mean =</span> fit<span class="sc">$</span>centers[cluster,<span class="dv">1</span>],</span>
<span id="cb22-5"><a href="#cb22-5" tabindex="-1"></a>                      <span class="at">cluster_sd =</span> fit<span class="sc">$</span>centers[cluster,<span class="dv">2</span>],</span>
<span id="cb22-6"><a href="#cb22-6" tabindex="-1"></a>                      )</span></code></pre></div>
<p>In the field of economics, there is a tendency to apply discrete categories, often based on historical but arbitrary thresholds, such as recession / not recession, stagflation, growth stocks versus value stocks… We should go beyond basic KPIs and try to approximate underlaying factors driving the markets.</p>
<p>Throughout this series, we will strive to analyze and categorize data in a way that reflects richer and higher-dimensional information.</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a><span class="fu">ggplot</span>(data_stats, <span class="fu">aes</span>(mean, sd, <span class="at">colour=</span><span class="fu">factor</span>(cluster))) <span class="sc">+</span></span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a>  <span class="fu">geom_point</span>() <span class="sc">+</span></span>
<span id="cb23-3"><a href="#cb23-3" tabindex="-1"></a>  <span class="fu">geom_label</span>(<span class="fu">aes</span>(<span class="at">label =</span> symbol), <span class="at">size=</span><span class="dv">3</span>, <span class="at">label.r =</span> <span class="fu">unit</span>(<span class="dv">5</span>, <span class="st">&#39;points&#39;</span>)) <span class="sc">+</span> </span>
<span id="cb23-4"><a href="#cb23-4" tabindex="-1"></a>  <span class="fu">guides</span>(<span class="at">colour=</span><span class="cn">FALSE</span>)</span></code></pre></div>
<p><img src="/post/value-invest-market-cap-data-r-ggplot-financial-times-theme/index_files/figure-html/cluster-1.png" width="672" /></p>
<p>We can easily expand our analysis to other stocks. Let’s discover how to do so in using the Financial Market Prep API and R package, and in next post we’ll elaborate on those ts clusterization methods, common patterns, turning points…</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>total_tickers <span class="ot">&lt;-</span> <span class="fu">fmpc_symbols_available</span>()</span></code></pre></div>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a>total_tickers<span class="sc">$</span>exchangeShortName <span class="sc">%&gt;%</span> <span class="fu">unique</span>() <span class="sc">%&gt;%</span> <span class="fu">head</span>(<span class="dv">20</span>)</span></code></pre></div>
<pre><code>##  [1] &quot;MCX&quot;      &quot;NYSE&quot;     &quot;AMEX&quot;     &quot;NASDAQ&quot;   &quot;TSX&quot;      &quot;ETF&quot;     
##  [7] &quot;NEO&quot;      &quot;CNQ&quot;      &quot;PNK&quot;      &quot;ASE&quot;      &quot;CBT&quot;      &quot;YHD&quot;     
## [13] &quot;EURONEXT&quot; &quot;OTC&quot;      &quot;LSE&quot;      &quot;SAO&quot;      &quot;IOB&quot;      &quot;XETRA&quot;   
## [19] &quot;STU&quot;      &quot;BER&quot;</code></pre>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>list_symbols <span class="ot">&lt;-</span> total_tickers <span class="sc">%&gt;%</span> <span class="fu">filter</span>(exchangeShortName<span class="sc">==</span><span class="st">&#39;NYSE&#39;</span>) <span class="sc">%&gt;%</span> <span class="fu">pull</span>(symbol)</span></code></pre></div>
<p>This APi call provides quite a lot (all) of them!</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>data <span class="ot">&lt;-</span> fmpcloudr<span class="sc">::</span><span class="fu">fmpc_security_mrktcap</span>(list_symbols, <span class="at">limit =</span> <span class="dv">30</span><span class="sc">*</span><span class="dv">3</span>)</span></code></pre></div>
<p>We now have the capability to conduct the analysis on the entire NYSE, or at least the most highly capitalized stocks. But that will be another day ;)</p>
<p>For now, we can see <strong>again a decay in the value stocks in these two first months of 2023</strong> vs the growth ones. The market has once again received a dose of optimism. Could it be a good option to start/continue a DCA strategy? Perhaps its suitability varies based on industry and current valuation? Most likely, it does.</p>
<p>We are extending this analysis and talking about valuation metrics in our second post of the series! So…</p>
<!-- Begin Mailchimp Signup Form -->
<link href="//cdn-images.mailchimp.com/embedcode/horizontal-slim-10_7.css" rel="stylesheet" type="text/css">
<link rel="stylesheet" type="text/css" href="https://csshake.surge.sh/csshake.min.css">
<style type="text/css">
	#mc_embed_signup{background:#fff; clear:left; font:14px Helvetica,Arial,sans-serif; width:100%;}
	 #mc_embed_signup .button {
  background-color: #0294A5; /* Green */
  color: white;
  transition-duration: 0.4s;
}
#mc_embed_signup .button:hover {
  background-color: #379392 !important; 
}

</style>
<div id="mc_embed_signup">
<form action="https://typethepipe.us4.list-manage.com/subscribe/post?u=91551f7ed29389a0de4f47665&amp;id=d95c503a48" method="post" id="mc-embedded-subscribe-form" name="mc-embedded-subscribe-form" class="validate" target="_blank" novalidate>
 <div id="mc_embed_signup_scroll">
	<label for="mce-EMAIL"> Don't miss the next chapters of the Financial Value Investing in R series!</label>
	<input type="email" value="" name="EMAIL" class="email" id="mce-EMAIL" placeholder="your best email" required>
    <!-- real people should not fill this in and expect good things - do not remove this or risk form bot signups-->
    <div style="position: absolute; left: -5000px;" aria-hidden="true"><input type="text" name="b_91551f7ed29389a0de4f47665_d95c503a48" tabindex="-1" value=""></div>
    <div class="clear"><input type="submit" value="Submit!" name="subscribe" id="mc-embedded-subscribe" class="button"></div>
    </div>
</form>
</div>

<!--End mc_embed_signup-->
<p><br></p>
</div>
</div>

              </div>
              







<div class="share-box" aria-hidden="true">
  <ul class="share">
    
      
      
      
        
      
      
      
      <li>
        <a href="https://twitter.com/intent/tweet?url=/post/value-invest-market-cap-data-r-ggplot-financial-times-theme/&amp;text=Financial%20Markets%20&amp;amp;%20Value%20Invest%20in%20R%20%28I%29%20-%20Analyzing%20Market%20Cap%20data%20with%20fmpcloudr%20and%20ggplot" target="_blank" rel="noopener" class="share-btn-twitter">
          <i class="fab fa-twitter"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.facebook.com/sharer.php?u=/post/value-invest-market-cap-data-r-ggplot-financial-times-theme/&amp;t=Financial%20Markets%20&amp;amp;%20Value%20Invest%20in%20R%20%28I%29%20-%20Analyzing%20Market%20Cap%20data%20with%20fmpcloudr%20and%20ggplot" target="_blank" rel="noopener" class="share-btn-facebook">
          <i class="fab fa-facebook"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="mailto:?subject=Financial%20Markets%20&amp;amp;%20Value%20Invest%20in%20R%20%28I%29%20-%20Analyzing%20Market%20Cap%20data%20with%20fmpcloudr%20and%20ggplot&amp;body=/post/value-invest-market-cap-data-r-ggplot-financial-times-theme/" target="_blank" rel="noopener" class="share-btn-email">
          <i class="fas fa-envelope"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://www.linkedin.com/shareArticle?url=/post/value-invest-market-cap-data-r-ggplot-financial-times-theme/&amp;title=Financial%20Markets%20&amp;amp;%20Value%20Invest%20in%20R%20%28I%29%20-%20Analyzing%20Market%20Cap%20data%20with%20fmpcloudr%20and%20ggplot" target="_blank" rel="noopener" class="share-btn-linkedin">
          <i class="fab fa-linkedin-in"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://web.whatsapp.com/send?text=Financial%20Markets%20&amp;amp;%20Value%20Invest%20in%20R%20%28I%29%20-%20Analyzing%20Market%20Cap%20data%20with%20fmpcloudr%20and%20ggplot%20/post/value-invest-market-cap-data-r-ggplot-financial-times-theme/" target="_blank" rel="noopener" class="share-btn-whatsapp">
          <i class="fab fa-whatsapp"></i>
        </a>
      </li>
    
      
      
      
        
      
      
      
      <li>
        <a href="https://service.weibo.com/share/share.php?url=/post/value-invest-market-cap-data-r-ggplot-financial-times-theme/&amp;title=Financial%20Markets%20&amp;amp;%20Value%20Invest%20in%20R%20%28I%29%20-%20Analyzing%20Market%20Cap%20data%20with%20fmpcloudr%20and%20ggplot" target="_blank" rel="noopener" class="share-btn-weibo">
          <i class="fab fa-weibo"></i>
        </a>
      </li>
    
  </ul>
</div>












  
    
    





  
  
  
  
  
  <div class="media author-card content-widget-hr">
    
      
      <img class="avatar mr-3 avatar-circle" src="/authors/carlos-vecina/carlos-vecina-avatar_hudcecee8c8ed4dd07fd2b73e656fad71c_149347_270x270_fill_lanczos_center_2.png" alt="Carlos Vecina">
    

    <div class="media-body">
      <h5 class="card-title"><a href="/authors/carlos-vecina/">Carlos Vecina</a></h5>
      <h6 class="card-subtitle">Senior Data Scientist at Jobandtalent</h6>
      <p class="card-text">Senior Data Scientist at Jobandtalent  |  AI &amp; Data Science for Business</p>
      <ul class="network-icon" aria-hidden="true">
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="/#contact" >
        <i class="fas fa-envelope"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://twitter.com/deepchals" target="_blank" rel="noopener">
        <i class="fab fa-twitter"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://www.linkedin.com/in/carlos-vecina/" target="_blank" rel="noopener">
        <i class="fab fa-linkedin"></i>
      </a>
    </li>
  
    
    
    
      
    
    
    
    
    
      
    
    <li>
      <a href="https://github.com/CarlosVecina" target="_blank" rel="noopener">
        <i class="fab fa-github"></i>
      </a>
    </li>
  
    
    
    
    
    
    
    
      
    
    <li>
      <a href="https://autarponics.com" target="_blank" rel="noopener">
        <i class="fa fa-home"></i>
      </a>
    </li>
  
</ul>

    </div>
  </div>


  










  
  


            </div>
        </article>
  

      

    
    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.4.1/jquery.min.js" integrity="sha256-CSXorXvZcTkaix6Yvo6HppcZGetbYMGWSFlBw8HfCJo=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.imagesloaded/4.1.4/imagesloaded.pkgd.min.js" integrity="sha256-lqvxZrPLtfffUl2G/e7szqSvPBILGbwmsGE1MKlOi0Q=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/jquery.isotope/3.0.6/isotope.pkgd.min.js" integrity="sha256-CBrpuqrMhXwcLLUd5tvQ4euBHCdh7wGlDfNz8vbu/iI=" crossorigin="anonymous"></script>
      <script src="https://cdnjs.cloudflare.com/ajax/libs/fancybox/3.5.7/jquery.fancybox.min.js" integrity="sha256-yt2kYMy0w8AbtF89WXb2P1rfjcP/HTHLT7097U8Y5b8=" crossorigin="anonymous"></script>

      

      
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/highlight.min.js" integrity="sha256-eOgo0OtLL4cdq7RdwRUiGKLX9XsIJ7nGhWEKbohmVAQ=" crossorigin="anonymous"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/r.min.js"></script>
        
        <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/9.18.1/languages/python.min.js"></script>
        
      

    

    
    
      <script src="https://cdnjs.cloudflare.com/ajax/libs/leaflet/1.5.1/leaflet.js" integrity="sha256-EErZamuLefUnbMBQbsEqu1USa+btR2oIlCpBJbyD4/g=" crossorigin="anonymous"></script>
    

    
    
    <script>const code_highlighting = true;</script>
    

    
    
    <script>const isSiteThemeDark = false;</script>
    

    
    
    
    
    
    
    <script>
      const search_config = {"indexURI":"/index.json","minLength":1,"threshold":0.3};
      const i18n = {"no_results":"No results found","placeholder":"Search...","results":"results found"};
      const content_type = {
        'post': "Posts",
        'project': "Projects",
        'publication' : "Publications",
        'talk' : "Talks"
        };
    </script>
    

    
    

    
    
    <script id="search-hit-fuse-template" type="text/x-template">
      <div class="search-hit" id="summary-{{key}}">
      <div class="search-hit-content">
        <div class="search-hit-name">
          <a href="{{relpermalink}}">{{title}}</a>
          <div class="article-metadata search-hit-type">{{type}}</div>
          <p class="search-hit-description">{{snippet}}</p>
        </div>
      </div>
      </div>
    </script>
    

    
    
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fuse.js/3.2.1/fuse.min.js" integrity="sha256-VzgmKYmhsGNNN4Ph1kMW+BjoYJM2jV5i4IlFoeZA9XI=" crossorigin="anonymous"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/mark.js/8.11.1/jquery.mark.min.js" integrity="sha256-4HLtjeVgH0eIB3aZ9mLYF6E8oU5chNdjU6p6rrXpl9U=" crossorigin="anonymous"></script>
    

    
    

    
    

    
    
    
    
    
    
    
    
    
      
    
    
    
    
    <script src="/js/academic.min.37431be2d92d7fb0160054761ab79602.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/popper.js/1.11.0/umd/popper.min.js" integrity="sha384-b/U6ypiBEHpOf/4+1nzFpr53nxSS+GLCkfwBdFNTxtclqqenISfwAzpKaMNFNmj4" crossorigin="anonymous"></script>

    
    

    






  
  
  <div class="container">
    <footer class="site-footer">
  
  <p class="powered-by">
    
      <a href="/privacy/">Privacy Policy</a>
    
    
       &middot; 
      <a href="/terms/">Terms and Conditions</a>
    
  </p>
  

  <p class="powered-by">
    

    Powered by the
    <a href="https://sourcethemes.com/academic/" target="_blank" rel="noopener">Academic theme</a> for
    <a href="https://gohugo.io" target="_blank" rel="noopener">Hugo</a>.
	<a href="https://www.r-bloggers.com/">
	<img border="0" alt="R Bloggers icon" src="/img/r_bloggers.png" width="100" height="100">
	</a>
	<br>
	<a href="https://www.python-bloggers.com/">
	<img border="0" alt="Python Bloggers icon" src="/img/python_logo.png" width="100" height="100">
	</a>
    
    <span class="float-right" aria-hidden="true">
      <a href="#" class="back-to-top">
        <span class="button_icon">
          <i class="fas fa-chevron-up fa-2x"></i>
        </span>
      </a>
    </span>
    
  </p>
  <style>
    #consent-notice {padding: 1rem 1rem; display: none; text-align: center; position: fixed; bottom: 0; width: calc(100% - 2rem); background: #222; color: rgba(255,255,255,0.8);}
    #consent-notice span {margin-right: 1rem;}
    #consent-notice button {cursor: pointer; display: inline-block; width: auto;}
    #consent-notice span a {color: inherit; text-decoration: underline; text-decoration-color: rgba(255,255,255,0.5);}
    #consent-notice button.btn {margin-left: 0.5rem;}
    #consent-notice button.btn.manage-consent {background: rgba(255,255,255,0.1); font-weight: normal;}
    
    #consent-overlay {position: fixed; left: 0; top: 0; width: 100%; height: 100vh; display: none; background: rgba(0,0,0,0.75); z-index: 999999; overflow: auto; cursor: pointer;}
    #consent-overlay.active {display: flex;}
    #consent-overlay > div {background: white; width: 100%; max-width: 30rem; padding: 1.75rem; margin: auto; cursor: initial;}
    #consent-overlay > div > div {display: flex; align-items: flex-start; margin-bottom: 1rem;}
    #consent-overlay > div > div:last-child {margin: 0;}
    #consent-overlay h3 {padding-top: 0;}
    #consent-overlay input {margin-top: 0.3rem;}
    #consent-overlay label {display: block;}
    #consent-overlay .btn {margin-right: 0.5rem;}
    #consent-overlay button.btn.save-consent {background: rgba(0,0,0,0.6); font-weight: normal;}

    @media (max-width: 767px) {
        #consent-overlay > div {padding: 1.75rem 1rem;}
        #consent-notice span {display: block; padding-top: 3px; margin-bottom: 1.5rem;}
        #consent-notice button.btn {position: relative; bottom: 4px;}
    }
</style>
<div id="consent-notice"><span>We would like to use <a class="manage-consent" href="#manage-consent">third party code</a> to improve the functionality of this website.</span><button class="btn manage-consent">Manage preferences</button><button class="btn deny-consent">Deny</button><button class="btn approve-consent">Allow</button></div>
<div id="consent-overlay">
    <div>
        
            <div>
                <input type="checkbox" id="item0" value="1" name="item0" checked disabled />
                <label for="item0">
                    <h3>Google Anaytics (functional)</h3>
                    <p>This code gives us insight into the number of anonymized people that visit our website, where they are from and what they are clicking on in order to create better content.</p>
                </label>
            </div>
        
            <div>
                <input type="checkbox" id="item1" value="1" name="item1"  />
                <label for="item1">
                    <h3>Marketing</h3>
                    <p>Marketing pourposes cookies.</p>
                </label>
            </div>
        
        <div>
            <button id="save-consent" class="btn save-consent" data-consentvalue="0">Save preferences</button>
            <button class="btn approve-consent">Allow all</button>
        </div>
    </div>
</div>
<script>

    const scripts = [];
    scripts[ 0 ] = "/js/mkt.js";

    function createCookie(name,value,days) {
        var expires = "";
        if (days) {
            var date = new Date();
            date.setTime(date.getTime() + (days*24*60*60*1000));
            expires = "; expires=" + date.toUTCString();
        }
        document.cookie = name + "=" + value + expires + "; path=/";
    }
    function readCookie(name) {
        var nameEQ = name + "=";
        var ca = document.cookie.split(';');
        for(var i=0;i < ca.length;i++) {
            var c = ca[i];
            while (c.charAt(0)==' ') c = c.substring(1,c.length);
            if (c.indexOf(nameEQ) == 0) return c.substring(nameEQ.length,c.length);
        }
        return null;
    }
    function eraseCookie(name) {
        createCookie(name,"",-1);
    }
    function denyAllConsentScripts() {
        var consentValue = "";
        scripts.forEach(function(){
            consentValue = consentValue + "0";
        });
        acceptSomeConsentScripts(consentValue);
    }
    function acceptAllConsentScripts() {
        var consentValue = "";
        scripts.forEach(function(){
            consentValue = consentValue + "1";
        });
        acceptSomeConsentScripts(consentValue);
    }
    function acceptSomeConsentScripts(consentValue) {
        setConsentInputs(consentValue);
        createCookie('consent-settings',consentValue,31);
        document.getElementById('consent-notice').style.display = 'none';
        document.getElementById('consent-overlay').classList.remove('active');
        loadConsentScripts(consentValue);
    }
    function loadConsentScripts(consentValue) {
        scripts.forEach(function(value,key){
            
            if(consentValue[key]=="1") {
                var s = document.createElement('script');
                s.type = 'text/javascript';
                s.src = value;
                document.body.appendChild(s);
            }
        });
    }
    function setConsentInputs(consentValue) {
        var elements = document.querySelectorAll('#consent-overlay input:not([disabled])');
        elements.forEach(function(el,index) {
            if(consentValue[index]=="1") el.checked = true;
            else el.checked = false;
        });
    }
    function setConsentValue() {
        var elements = document.querySelectorAll('#consent-overlay input:not([disabled])');
        var consentValue = "";
        elements.forEach(function(el) {
            if(el.checked) consentValue = consentValue + "1";
            else consentValue = consentValue + "0";
        });
        document.getElementById("save-consent").dataset.consentvalue = consentValue;
    }

    var elements = document.querySelectorAll('#consent-overlay input:not([disabled])');
    elements.forEach(function(el) {
        el.checked = false;
    });

    if(readCookie('consent-settings')) {
        var consentValue = readCookie('consent-settings').toString();
        
        setConsentInputs(consentValue);
        loadConsentScripts(consentValue);
    } else {
        document.getElementById('consent-notice').style.display = 'block';
    }
    var elements = document.querySelectorAll('.manage-consent');
    elements.forEach(function(el) {
        el.addEventListener("click",function() {
            document.getElementById('consent-overlay').classList.toggle('active');
        });
    });
    var elements = document.querySelectorAll('.deny-consent');
    elements.forEach(function(el) {
        el.addEventListener("click",function() {
            denyAllConsentScripts();
        });
    });
    var elements = document.querySelectorAll('.approve-consent');
    elements.forEach(function(el) {
        el.addEventListener("click",function() {
            acceptAllConsentScripts();
        });
    });
    document.getElementById("save-consent").addEventListener("click",function() {
        setConsentValue();
        acceptSomeConsentScripts(this.dataset.consentvalue);
    });
    document.getElementById("consent-overlay").addEventListener("click",function(e) {
        if (!document.querySelector("#consent-overlay > div").contains(e.target)){
            this.classList.toggle('active');
        }
    });
</script>


    
        <script type="text/javascript" src="/js/ga.js"></script>
    

    

</footer>

  </div>
  

  
<div id="modal" class="modal fade" role="dialog">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Cite</h5>
        <button type="button" class="close" data-dismiss="modal" aria-label="Close">
          <span aria-hidden="true">&times;</span>
        </button>
      </div>
      <div class="modal-body">
        <pre><code class="tex hljs"></code></pre>
      </div>
      <div class="modal-footer">
        <a class="btn btn-outline-primary my-1 js-copy-cite" href="#" target="_blank">
          <i class="fas fa-copy"></i> Copy
        </a>
        <a class="btn btn-outline-primary my-1 js-download-cite" href="#" target="_blank">
          <i class="fas fa-download"></i> Download
        </a>
        <div id="modal-error"></div>
      </div>
    </div>
  </div>
</div>

</body>
</html>
